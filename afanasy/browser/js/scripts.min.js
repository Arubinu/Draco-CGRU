document.addEventListener("DOMContentLoaded",e=>{var t=new Event("DOMContentLoadedAfanasy");t.global={source:"./afanasy/browser/",logs:{},logs_ids:{},nodes_data:{},ping_refresh:{},grid_size:{x:1,y:2},grid_template:{x:[],y:[]},grid_filling:[{type:"jobs",position:{x:1,y:1},size:{width:1,height:1}},{type:"renders",position:{x:1,y:2},size:{width:1,height:1}}],cell_active:!1,cell_increment:0,cell_width:600,cell_height:180},t.config={get:(e,r)=>{if(r=r||e,["string","number"].indexOf(typeof e)<0)return null;var o=t.config;return Array.prototype.forEach.call(e.split("."),e=>{"object"==typeof o&&(o=o[e])}),void 0!==o?o:r}},t.langs={get:(e,r)=>{if(r=r||e,["string","number"].indexOf(typeof e)<0)return r;var o=t.langs[t.langs.selected];return void 0!==(o=o[e=e.indexOf("=trans:")?e:e.substr(7)])?o:r},selected:localStorage.lang||navigator.language||navigator.userLanguage},t.templates={all:{},get:(e,r,o)=>{var n=t.templates.all[e];if(n="function"!=typeof n?"":n(r||t.config.get(e,{})),o){var a=document.createElement("get");a.innerHTML=n,a.children.length?(t.tools.handlebars(a),n=a.children[0],a.removeChild(a.children[0])):n=!1}return n}},t.tools={isset:function(){var e=!0;Array.prototype.forEach.call(arguments,t=>{e=e&&void 0!==t})},handlebars:e=>{Array.prototype.forEach.call(e.querySelectorAll("[handlebars][handlebars-autoload]"),e=>{var r=e.getAttribute("handlebars-data");try{if(!(r=JSON.parse(r)))throw""}catch(e){r={}}var o=e.getAttribute("handlebars");if(r=Object.assign(r,t.config.get(o,{})),e.parentNode&&e.hasAttribute("handlebars-replace")){var n=t.templates.get(o,r,!0);n.setAttribute("class",(n.getAttribute("class")||"")+(e.getAttribute("class")||"")),n.setAttribute("style",(n.getAttribute("style")||"")+(e.getAttribute("style")||"")),e.replaceWith(n),e=n}else e.innerHTML=t.templates.get(o,r);e.querySelectorAll("[handlebars][handlebars-autoload]").length&&t.tools.handlebars(e)})},ajax:(e,r,o,n)=>{n="function"==typeof n?n:e=>{console.error(e)},r=Object.assign({method:"GET",body:null,input:!1},r);var a=new XMLHttpRequest;return a.onerror=n,a.ontimeout=(()=>{}),a.onreadystatechange=function(e){if(4==this.readyState){var a=!1,s=this.responseText;if(200==this.status){if("json"===r.input)try{s=JSON.parse(s)}catch(e){a=e.message}else if("html"===r.input){var l=document.createElement("ajax");s=s.replace(/\{\{[\s]?config\s'(.*?)'[\s]?\}\}/g,(e,r,o,n)=>t.config.get(r)),l.innerHTML=s,1==l.childNodes.length&&l.childNodes[0]instanceof Text?a="SyntaxError: missing html":s=l}}else a=this.statusText;a&&n?n.apply(this,[e,this.status,this.statusText]):a?console.error(this.status,this.statusText):o.apply(this,[e,s])}},a.timeout=2e3,a.open(r.method,e,!0),a.send(r.body),a},import:(e,r,o)=>{var n=document.createElement("script");n.setAttribute("type","text/javascript"),"object"==typeof r&&Array.prototype.forEach.call(Object.keys(r),e=>{n.setAttribute(e,r[e])}),n.loaded=!1,o?t.tools.ajax(e,!1,(e,t)=>{n.innerHTML=t,n.loaded=!0},t=>{n.error=!0,console.error("import:",e,t.statusText)}):(n.onload=function(){this.loaded=!0},n.onerror=function(){this.error=!0},n.setAttribute("src",e)),document.head.appendChild(n)},merge:(e,r)=>{var o=Array.isArray(e);return o!==Array.isArray(r)?r:(Array.prototype.forEach.call(o?r:Object.keys(r),o=>{var n=r[o];if(o in e){var a=typeof n;"object"===a?e[o]=t.tools.merge(e[o],n):"number"!==a&&"string"!==a||(e[o]+=n)}else e[o]=n}),e)},time:{get:(e,t,r)=>{e=!e||e<0?0:e,e/=e>=1e10?1e3:1;var o=Math.floor(e/3600),n=Math.floor(e/60%60),a=Math.floor(e%60);return("0"+o).slice(-2)+(t||":")+("0"+n).slice(-2)+(r||":")+("0"+a).slice(-2)},unit:e=>{e=!e||e<0?0:e,e/=e>=1e10?1e3:1;var t=Math.floor(e/3600),r=Math.floor(e/60%60),o=Math.floor(e%60),n="";return n+=t?t+(r?"."+("0"+r).slice(-2):"")+"h":r?r+(o?"."+("0"+o).slice(-2):"")+"m":o+"s"},diff:{get:(e,r,o,n)=>(e=t.tools.time.diff.logic(e,r),t.tools.time.get(e,o,n)),unit:(e,r)=>t.tools.time.unit(t.tools.time.diff.logic(e,r)),logic:(e,t)=>(!0===t?t=Date.now()/1e3:"number"!=typeof t&&(t=!1),e=e||t||0,t&&(e/=e>=1e10?1e3:1,e=(t/=t>=1e10?1e3:1)-e),e)}},ping_refresh:e=>{var r=e;if(e&&!e.classList.contains("cell")&&(r=$.parent(e,".cell")),r instanceof HTMLElement||r instanceof Node){var o=r.uid;t.global.ping_refresh[o]&&clearTimeout(t.global.ping_refresh[o]),r.querySelector(".title .refresh").style.opacity=1,t.global.ping_refresh[o]=setTimeout(()=>{t.global.ping_refresh[o]=!1,r.querySelector(".title .refresh").style.opacity=0},100)}},infos_pile:(e,t,r)=>{if(r.total=r.total||0,!(void 0!==e.host_name&&!e.host_name)){++r.total;var o=(e.blocks&&e.blocks[0].state||e.state||"").trim().split(" ").slice(-1)[0];o&&("number"!=typeof r[o]&&(r[o]=0),++r[o])}},infos_print:function(e,r,o){var n="";if(arguments.length>1){var a=t.config.get("states");r.total=r.total||0,n+=r.total+" total",Array.prototype.forEach.call(Object.keys(r),e=>{var s=r[e];["length","total","null"].indexOf(e)>=0||!s||"number"!=typeof s||(e in a||o)&&(n+=", "+s+" "+t.langs.get(a[e]||e).toLowerCase())}),e.setAttribute("cell-infos",n)}else n+=e.getAttribute("cell-infos")||"";var s=e.querySelectorAll(".selected").length;s&&(n+=", "+s+" "+t.langs.get("selected").toLowerCase()),e.parentNode.querySelector(".subtitle .infos").textContent=n},table:function(e){var t=Array.prototype.slice.call(arguments,1);t&&Array.prototype.forEach.call(e,e=>{var r=[];Array.prototype.forEach.call(e.querySelectorAll(".frame > table, .frame.frame-tabs > [tab-id] > table"),e=>{var t=e.querySelector(":scope > thead"),o=e.querySelector(":scope > tbody"),n=o&&o.querySelector(":scope > tr[row-template]");n&&(n=n.cloneNode(!0)).removeAttribute("row-template"),r.push({elem:e,thead:t,tbody:o,template:n})}),Array.prototype.forEach.call(t,t=>{try{t(e,r)}catch(e){}})})},menu_rarrow:e=>{Array.prototype.forEach.call(e.querySelectorAll("ul"),e=>{var t=e.parentNode;if("LI"===t.tagName.toUpperCase()&&!t.querySelector(":scope > .rarrow")&&t.querySelector(":scope > .icon")){var r=document.createElement("div");r.classList.add("rarrow"),t.prepend(r)}})},columns:(e,r)=>{Array.prototype.forEach.call(r,e=>{var t=(e.elem.getAttribute("col-hides")||"").split("|");Array.prototype.forEach.call(e.thead.querySelectorAll("[col-name]"),r=>{var o=r.getAttribute("col-name"),n=t.indexOf(o)>=0;r.style.display=n?"none":null,Array.prototype.forEach.call(e.tbody.querySelectorAll(".col-"+o),e=>{e.style.display=n?"none":null})})});var o=$.parent(e,".cell").querySelector(".search input");o&&o.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0}));var n=()=>{Array.prototype.forEach.call(r,e=>{Array.prototype.forEach.call(e.elem.querySelectorAll(":scope > tbody > tr:not([row-template]).filter-hide"),e=>{e.classList.remove("filter-hide")})})},a=e.getAttribute("cell-type"),s=decodeURIComponent(e.getAttribute("selected-filter"));if(a&&s){var l=t.functions.get_filters(a);if("object"==typeof l[s]&&Array.isArray(l[s])){var i=l[s];Array.prototype.forEach.call(r,e=>{Array.prototype.forEach.call(e.elem.querySelectorAll(":scope > tbody > tr:not([row-template])"),e=>{for(var t=!1,r=0;!t&&r<i.length;++r){var o=i[r].value,n=e.querySelector(":scope > .col-"+i[r].column);if(n)switch("-"==(n=n.textContent.trim())&&(n=""),i[r].param){case"contains":t=!(n.indexOf(o)>=0)||next;break;case"not-contains":t=!(n.indexOf(o)<0)||next;break;case"starts-with":t=!!n.indexOf(o)||next;break;case"ended-by":t=!!n.substr(-o.length).indexOf(o)||next;break;case"equals":t=n!=o||next;break;case"not-equals":t=n==o||next;break;case"after":case"greater-than":t=!(n>o)||next;break;case"before":case"less-than":t=!(n<o)||next}}e.classList.toggle("filter-hide",t)})})}else n()}else n()},selected:{window:e=>{if(e){var r=document.querySelector('.cell[data-uid="'+e+'"] > .win');if(r)return r.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0})),r.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0})),r}return(e=t.global.cell_active)&&document.querySelector('.cell[data-uid="'+e+'"] .win')},lines:e=>{e=!(!e||"string"!=typeof e)&&e;var r=[[]],o=t.tools.selected.window();return o&&Array.prototype.forEach.call(o.querySelectorAll("[node-id].selected"),t=>{id=t.getAttribute("node-id"),e?(id=id.split(e),Array.prototype.forEach.call(id,(e,t)=>{r[t]||(r[t]=[]),r[t].push(Number.parseInt(e))})):r[0].push(Number.parseInt(id))}),e?r:r[0]}},progress2bar:(e,t)=>{var r,o="",n=0;if(t="function"==typeof(t=t||e.order)?t:(e,t)=>{var r=!1;switch(e){case 1:r=t.done;break;case 2:r=t.error;break;case 3:r=t.waitdep+t.waitreconnect;break;case 4:r=t.null;break;case 5:r=t.warning}return r},e.total)for(var a=1;a<=100;++a)!1!==(r=t(a,e))&&(o+="--segment"+a+": calc( "+(n+=r)+" / "+e.total+" * 100 );");return o}},t.functions={app_refresh:()=>{document.location.reload(!0)},app_about:()=>{var e=t.templates.get("cell-about");t.system.windows.confirm({html:e},t.langs.get("toolbar.help.about"),!1,!0)},login_user:(e,r,o)=>{if(r){var n=r.querySelector("[name=login-username]"),a=r.querySelector("[name=login-hostname]"),s=r.querySelector("[name=login-uilevel]"),l=n.value.trim(),i=a.value.trim(),c=s.options[s.selectedIndex].textContent.trim();if(!0===e||!l||!i||!c){var d=t.langs.get("empty-fields"),u=r.querySelector(".win > .error");u.classList.remove("notice"),u.classList.remove("hide"),u.textContent=d;var p=(e,t)=>{u.classList.add("hide");var r="",o=s.options[s.selectedIndex].textContent.trim();switch(cm_UILevels.indexOf(o)){case 0:r="Patience you must have, my young padawan.";break;case 1:r="May the Force be with you.";break;case 2:r="Powerful you have become, the dark side I sense in you."}r&&(u.textContent=r,u.classList.add("notice"),u.classList.remove("hide"))};return n.onkeydown=p,a.onkeydown=p,s.onchange=p,!0===e&&p(),d}localStorage.user_name=l,localStorage.host_name=i,t.system.ui_level.apply(c),document.location.reload(!0)}r=t.system.windows.confirm({html:t.templates.get("cell-login",{username:localStorage.user_name||"",hostname:localStorage.host_name||"",uilevel:localStorage.ui_level||"",uilevels:cm_UILevels},!0).outerHTML,button:"confirm",callback:"login_user"},t.langs.get("toolbar.file.login-user"));t.functions.login_user(!0,r)},logout_user:e=>{t.system.register.logout()},language_load:(e,t)=>{localStorage.lang=t,document.location.reload(!0)},get_filters:e=>{e="filters_"+e;var t=!1;if(localStorage[e])try{t=JSON.parse(localStorage[e])}catch(e){}return"object"!=typeof t&&(t={}),t},set_filters:(e,t)=>{e="filters_"+e;try{localStorage[e]=JSON.stringify(t)}catch(e){}},win_main_toolbar:e=>{document.body.classList.toggle("main-toolbar")},win_lock:e=>{document.body.classList.toggle("locked");var r=document.body.classList.contains("locked"),o=document.querySelector('[name="lock-panels"] > img');return o.setAttribute("src",o.getAttribute("src").split("/").slice(0,-1).join("/")+"/"+(r?"":"un")+"lock.png"),t.system.lock_refresh(),r},win_add:(e,r,o,n,a,s,l)=>{var i=t.templates.get("cell-"+r,l||!1,!0),c=window.cell_create(i,!1,s);return i.setAttribute("cell-type",r),localStorage[r+"_size"]||(c.style.width=n||t.global.cell_width+"px",c.style.height=a||t.global.cell_height+"px"),o&&window.cell_refresh(r),c},cell_active:(e,r,o)=>{t.tools.selected.window(r)},win_copy:(e,r,o)=>{var n=t.tools.selected.window();if(n){var a=[],s=[],l=[];Array.prototype.forEach.call(n.querySelectorAll("[node-id].selected"),(e,t)=>{if(e.offsetWidth||e.offsetHeight){var r=-1,o=[];Array.prototype.forEach.call(e.children,e=>{if(e.offsetWidth||e.offsetHeight){var n="";if(e.classList.contains("col-icon")){var a=e.querySelector("img");a&&(n=a.getAttribute("src").split("/").slice(-1)[0].split(".")[0]),n="void"===n?"":n}else e.classList.contains("col-progress")&&(e=e.querySelector(".col-progress-text")),n=e.textContent.trim().replace(/\n/g," ").replace(/\r/g,"");if(s[++r]=!s[r]||n.length>s[r]?n.length:s[r],o[r]=n,!t){var i=window.getComputedStyle(e);l[r]=["left","center","right"].indexOf(i.getPropertyValue("text-align"))}}}),o.length&&a.push(o)}});var i="";Array.prototype.forEach.call(a,(e,t)=>{var r="";Array.prototype.forEach.call(e,(e,t)=>{var o,n=s[t],a=l[t];if(1==a){n-=e.length;var i=Math.floor(n/2),c=n-i;o=" ".repeat(i)+e+" ".repeat(c)}else{var d=" ".repeat(n-e.length);o=2==a?d+e:e+d}r+=(r?" ‖ ":"")+o}),i+="\n‖ "+r+" ‖"}),i.trim().toClipboard()}},win_select_all:(e,r,o)=>{var n=t.tools.selected.window();n&&Array.prototype.forEach.call(n.querySelectorAll("[node-id]:not(.search-hide):not(.filter-hide)"),e=>{e.classList.add("selected")})},win_select_next:(e,r)=>{var o=t.tools.selected.window();if(o){var n=t.tools.selected.lines();if(n.length){n=o.querySelector('[node-id="'+n[0]+'"]');do{if(!(n=n&&n[r?"previousElementSibling":"nextElementSibling"])||!n.classList.contains("hide"))break}while(n&&n.getAttribute("node-id"))}else n=o.querySelector("[node-id]:not(.search-hide):not(.filter-hide)");n&&n.getAttribute("node-id")&&!n.classList.contains("hide")&&(Array.prototype.forEach.call(o.querySelectorAll("[node-id]"),e=>{e.classList.remove("selected")}),n.classList.add("selected"))}},win_confirm:function(){t.system.windows.confirm(...Array.prototype.slice.call(arguments,1))},win_right:(e,r,o)=>{var[n,a]=t.tools.selected.lines(":");n=n&&n.filter((e,t,r)=>r.indexOf(e)==t),a=a&&a.filter((e,t,r)=>r.indexOf(e)==t);var s=t.tools.selected.window();if(s&&n.length){var l=s.getAttribute("cell-type");t.functions.win_actions[l](e,l,r,o,n,a)}},win_filters:(e,r,o)=>{var n=t.tools.selected.window();if(n){var a=n.getAttribute("cell-type"),s=n.getAttribute("cell-filters");if(a&&s){s=JSON.parse(s);var l={type:a,columns:s,data:{}},i=t.functions.win_add(e,"filters",!1,"605px","240px",{autosize:!1,noattach:!1,noresize:!1,subtitle:t.langs.get(a)},l),c=i.querySelector('[name="confirm"]'),d=i.querySelector('select[name="filter-type"]'),u=i.querySelector(".filter-table"),p=u.querySelector("[row-template]"),y=i.querySelector("[name=filter-add]");p.parentNode.removeChild(p),p.removeAttribute("row-template");var m=()=>{Array.prototype.forEach.call(u.querySelectorAll("table > tbody > tr"),e=>{e.parentNode.removeChild(e)})};d.onchange=(e=>{if(Array.prototype.forEach.call(d.options,(e,r)=>{var o=r==d.options.selectedIndex?"initial":"none",n=i.querySelector('[name="filter-'+e.value+'"]');n.style.display=o,n.onkeyup=(e=>{c.onclick(!0)}),n.onchange=(r=>{if(c.onclick(!0),"saved"==e.value){m();var o=t.functions.get_filters(a);o="object"==typeof o[n.value]?o[n.value]:{},Array.prototype.forEach.call(Object.keys(o),e=>{var t=o[e];y.onclick(!1,t.column,t.param,t.value)})}})}),m(),"saved"==d.value){var r=i.querySelector('select[name="filter-'+d.value+'"]');Array.prototype.forEach.call(r.querySelectorAll("option"),e=>{e.value&&e.parentNode.removeChild(e)}),Array.prototype.forEach.call(Object.keys(t.functions.get_filters(a)),e=>{var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)})}else i.querySelector('[name="filter-'+d.value+'"]').value="";c.onclick(!0)}),y.onclick=((e,t,r,o)=>{var n=p.cloneNode(!0);u.querySelector("table > tbody").appendChild(n);var a=n.querySelector('select[name="filter-column"]');a.onchange=((e,t,r)=>{var o,n,s=a.parentNode.parentNode;if(index=a.selectedOptions[0].getAttribute("param"),(o=u.querySelector('[params-template="'+index+'"]').cloneNode(!0)).setAttribute("name","filter-param"),(n=s.querySelector('[col-name="param"]')).innerHTML="",n.appendChild(o),t&&Array.prototype.forEach.call(o.querySelectorAll("option"),e=>{e.value==t&&e.setAttribute("selected","selected")}),(o=u.querySelector('[values-template="'+index+'"]').cloneNode(!0)).setAttribute("name","filter-value"),(n=s.querySelector('[col-name="value"]')).innerHTML="",n.appendChild(o),r){var l=o.tagName.toUpperCase();"SELECT"===l?Array.prototype.forEach.call(o.querySelectorAll("option"),e=>{e.value==r&&e.setAttribute("selected","selected")}):"INPUT"===l&&(o.value=r)}}),t&&Array.prototype.forEach.call(a.querySelectorAll("option"),e=>{e.value==t&&e.setAttribute("selected","selected")}),a.onchange(!1,r,o),n.querySelector('[name="filter-remove"]').onclick=(e=>{n.parentNode.removeChild(n)})}),c.onclick=(e=>{var r=d.value,o=i.querySelector('[name="filter-'+r+'"]'),n="new"==r&&o.value.length||"saved"==r&&o.options.selectedIndex;if(!0===e)return n?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled"),n;if(n){var s=!1,l={type:r,name:o.value,filters:[]};if(Array.prototype.forEach.call(u.querySelectorAll("table > tbody > tr"),e=>{if(!s){var t=e.querySelector("[name=filter-value]"),r=t.tagName.toUpperCase(),o=(t.getAttribute("type")||r).toUpperCase(),n=t.value;"NUMBER"==o?n=Math.floor(Number.parseInt(n)/1e3):"TIME"==o?n=Math.floor(Date.parse("1970-01-01T"+n)/1e3):o.indexOf("DATETIME")?"SELECT"==r||n||(n=NaN):n=Math.floor(Date.parse(n)/1e3),Number.isNaN(n)&&(s=!0),l.filters.push({column:e.querySelector("[name=filter-column]").value,param:e.querySelector("[name=filter-param]").value,value:n})}}),s)return t.system.windows.confirm({text:t.langs.get("empty-fields")},t.langs.get("error"),!1,!0);var p=t.functions.get_filters(a);p[l.name]=l.filters,t.functions.set_filters(a,p),window.cell_close(i.uid)}}),d.onchange()}}},win_actions:{fn:{base:function(e,r,o,n,a,s){var l=Object.assign({},t.functions.win_actions.fn);l[o in l?o:"action"](...arguments)},log:(e,r,o,n,a,s)=>{n=n||"log",t.system.xhr.send({get:{type:r,ids:[a[0]],mode:n}},e=>{var r,a,s="";void 0!==e.object?(r=e.object.name,a=n+(n.indexOf("log")<0?"_log":""),s="<pre>"+JSON.stringify(e.object,void 0,2)+"</pre>",e={message:{name:n,type:o,list:[s]}}):[r,a,s]=[e.message.name,e.message.type,e.message.list],t.system.windows.text(s,t.langs.get(a),r)})},action:(e,r,o,n,a,s)=>{var l,i=null;void 0!==n?(i={})[o]=n:l={type:o},t.system.action.send(r,a,l,i,s)},action_task:(e,r,o,n,a,s,l)=>{if(a=a.filter((e,t,r)=>r.indexOf(e)==t),s=s.filter((e,t,r)=>r.indexOf(e)==t),void 0===l){var i=a;a=s,s=i;var c=t.tools.selected.window(),d=c&&"tasks"==c.getAttribute("cell-type")&&$.parent(c,".cell");if(!(d&&d.uid&&d.uid in t.global.nodes_data.tasks))return;l=t.global.nodes_data.tasks[d.uid].id}var u;u={type:n,task_ids:a},t.system.action.send("jobs",[l],u,null,s)},move:(e,r,o,n,a,s)=>{var l={type:n,jids:a};t.system.action.send("users",[g_uid],l),t.system.info("Moving Jobs")},data:(e,r,o,n,a,s)=>{var l=[],i=!1;Array.prototype.forEach.call(a,e=>{var o=t.global.nodes_data[r][e],n=s||[-1];i=n.length>1,Array.prototype.forEach.call(n,e=>{var t=-1!==e||Array.isArray(o)?o[e]:o;if(t){var r=i?"<strong><u>"+t.name+":</u></strong><br />":"",n="<pre>"+JSON.stringify(t.data,void 0,2)+"</pre>";l.push(r+n)}})});var c=void 0;if(!i){var d=t.global.nodes_data[r][a[0]];if(Array.isArray(d)){var u=s?s[0]:-1;void 0!==d[u]&&(c=d[u].name)}else"object"==typeof d&&(c=d.name)}t.system.windows.text(l,t.langs.get("properties"),c)}},jobs:function(){t.functions.win_actions.fn.base(...arguments)},tasks:function(){t.functions.win_actions.fn.base(...arguments)},monitors:function(){t.functions.win_actions.fn.base(...arguments)},renders:function(){t.functions.win_actions.fn.base(...arguments)},users:function(){t.functions.win_actions.fn.base(...arguments)}},launch_cmd:(e,r,o,n,a,s)=>{o.id,o.input.elements[0].name;var l=r.querySelector('input[name="'+o.id+"_"+o.input.elements[0].name+'"]').value.trim(),i="lcex"==o.type;t.system.info("launchCmd"+(i?"Exit":"")+" = "+o.type+": "+l),t.system.action.send("renders",a,{type:"launch_cmd",cmd:l,exit:i},null)},service:(e,r,o,n,a,s)=>{var l=o.id+"_"+o.input.elements[0].name,i=r.querySelector('input[name="'+o.id+"_"+o.input.elements[0].name+'"]').value.trim();t.system.info("menuHandleService = "+i+": "+l),t.system.action.send("renders",a,{name:i,type:"service",enable:"enable"==o.type},null)},custom_data:(e,r,o,n,a,s)=>{o.id,o.input.elements[0].name;var l=r.querySelector('input[name="'+o.id+"_"+o.input.elements[0].name+'"]'),i=l.value.trim();try{i=JSON.parse(i)}catch(e){var c=r.querySelector(".win > .error");return c.classList.remove("hide"),c.textContent=e.message,l.onkeydown=(()=>{c.classList.add("hide")}),e.message}var d={};d.custom_data=i,t.system.action.send("users",a,null,d)},table_sort:(e,r,o)=>{var n=!1,a=e.querySelector(":scope > tbody"),s=e.querySelector(":scope > thead > tr > th[col-sort]");s&&(n=s.getAttribute("col-sort"),column_name=s.getAttribute("col-name"));var l=$.parent(e,".win"),i=l&&l.getAttribute("cell-type"),c=l&&i&&window[i[0].toUpperCase()+i.substr(1)+"Sort"];"function"!=typeof c&&(c=!1);var d=r?'[node-id^="'+o+':"]':'[node-id]:not([node-id*=":"])',u=Array.prototype.slice.call(a.querySelectorAll(":scope > tr"+d));u.sort(function(e,t){if(n){var r=e.querySelector(":scope > .col-"+column_name).textContent,o=t.querySelector(":scope > .col-"+column_name).textContent;if("up"==n&&r<o||"down"==n&&r>o)return 1;if("up"==n&&r>o||"down"==n&&r<o)return-1}else{if(c)return c(e,t);if(e.querySelector(":scope > .col-id"),t.querySelector(":scope > .col-id"),e&&t){if(e.textContent>t.textContent)return 1;if(e.textContent<t.textContent)return-1}}return 0});var p=!1;return Array.prototype.forEach.call(u,(n,s)=>{s?p.after(n):r?a.querySelector(':scope > tr[node-id="'+o+'"]').after(n):n.previousElementSibling&&a.prepend(n);var l=n;if(!r){var i=t.functions.table_sort(e,!0,n.getAttribute("node-id"));i&&(l=i)}p=l}),p}},t.system={log:(e,r)=>{r=r||"log","string"!=typeof e&&(e="<pre>"+JSON.stringify(e,void 0,2)+"</pre>"),Array.isArray(t.global.logs[r])||(t.global.logs[r]=[],t.global.logs_ids[r]=0);for(var o=-1,n=-1,a=g_cycle,s=Date.now(),l=t.global.logs[r],i=0;i<l.length;++i){if(n<0)n=l[i].cycle;else if(n!=l[i].cycle)break;if(e==l[i].msg){for(var c=0;c<l.length;++c)n==l[c].cycle&&(l[c].cycle=a);l[i].activity=s,l[i].count+=1,o=i;break}}if(o<0){l.unshift({id:++t.global.logs_ids[r],msg:e,register:s,activity:0,count:1,cycle:a});for(i=l.length;i>=t.config.logs_max;--i)l.pop()}},info:(e,r)=>{null!=r&&1!=r||t.system.log(e),$("#statusbar .status").textContent=e},error:(e,r)=>{t.system.info("Error: "+e,r)},action:{send:(e,r,o,n,a)=>{if(0==r.length)return t.system.error(e+" Action: IDs are empty.");var s=t.system.action.object(e,r);n&&(s.action.params=n),o&&(s.action.operation=o),a&&(s.action.block_ids=a),t.system.xhr.send(s)},object:(e,t)=>{return{action:{ids:t,type:e,user_name:localStorage.user_name,host_name:localStorage.host_name}}}},connection:{lost:()=>{0!=g_id&&(t.system.info("Connection Lost."),t.system.register.unset())}},lock_refresh:()=>{Array.prototype.forEach.call(document.querySelectorAll("#grid > div.empty-cell"),e=>{e.parentNode.removeChild(e)});var e=document.body.classList.contains("locked");if(Array.prototype.forEach.call(document.querySelectorAll(".grid-edit"),t=>{t.classList.toggle("disabled",e)}),!e)for(var r=1;r<=t.global.grid_size.y;++r)for(var o=1;o<=t.global.grid_size.x;++o){var n=document.createElement("div");n.classList.add("empty-cell"),n.setAttribute("grid-x",o),n.setAttribute("grid-y",r),n.style.gridArea=r+" / "+o+" / span 1 / span 1",Array.prototype.forEach.call([{type:"row",position:"y",check:1==o&&r<t.global.grid_size.y},{type:"column",position:"x",check:1==r&&o<t.global.grid_size.x}],(e,t)=>{if(e.check){var a=document.createElement("div");a.classList.add("rule"),a.setAttribute("grid-index","x"==e.position?o:r),a.setAttribute("grid-type",e.type),a.setAttribute("grid-position",e.position),n.appendChild(a)}}),grid.appendChild(n)}},register:{set:()=>{if(0==g_id){t.system.info("Sending register request.");var e={monitor:{}};e.monitor.user_name=localStorage.user_name,e.monitor.host_name=localStorage.host_name,e.monitor.engine=cgru_Browser,t.system.xhr.send(e),setTimeout(t.system.register.set,5e3)}},receive:e=>{g_id=e.id,e.uid&&e.uid>0&&(g_uid_orig=e.uid,-1==g_uid&&(g_uid=g_uid_orig)),localStorage.time_register=Date.now()/1e3;var r=document.querySelector("#statusbar .user"),o="string"==typeof localStorage.ui_level?localStorage.ui_level.toLowerCase():"";r.setAttribute("class","user "+o),r.setAttribute("title","ID: "+g_id+" UID: "+g_uid),r.querySelector(".name").textContent=localStorage.user_name,document.title="AF",t.system.info("Registered: ID = "+g_id+' User = "'+localStorage.user_name+'"['+g_uid+"]"),t.system.g_MButtonClicked(g_main_monitor_type),t.system.register.super()},super:()=>{var e="",r=$(".toolbar-menu .infos-type"),o=t.system.g_GOD(),n=t.system.g_VISOR();if(o||n){g_uid=0;var a=o?"god":"visor";r.classList.add("su_"+a),r.setAttribute("title","mode: "+a.toUpperCase()),e=a.toUpperCase()[0]}else g_uid=g_uid_orig,r.classList.remove("su_god"),r.classList.remove("su_visor"),r.setAttribute("title","");if((r.children?r.children[0]:r).textContent=e,0==g_uid){var s=t.system.action.object("monitors",[g_id]);s.action.operation={uid:0,type:"watch",class:"perm"},t.system.xhr.send(s)}},logout:()=>{t.system.digest.remove(),window.location.reload()},unset:()=>{if(0!=g_id){g_id=0,g_uid=-1,g_uid_orig=-1;var e=document.querySelector("#statusbar .user"),r="string"==typeof localStorage.ui_level?localStorage.ui_level.toLowerCase():"";e.setAttribute("class","user "+r),e.setAttribute("title","ID: "+g_id+" UID: "+g_uid),e.querySelector(".name").textContent=localStorage.user_name,window.document.title="AF (deregistered)",t.system.info("Deregistered."),t.system.g_CloseAllWindows(),t.system.g_CloseAllMonitors(),t.system.register.set()}}},xhr:{send:(e,r)=>(e={send:e},r&&(e.func=r),t.system.xhr.request(e),!1),request:e=>{if(!g_closing){var r=e.send;g_digest&&(++g_auth.nc,g_auth.response=hex_md5(g_digest+":"+g_auth.nonce+":"+g_auth.nc),r.auth=g_auth);var o=new XMLHttpRequest,n=JSON.stringify(r);o.m_log="<b><i>send:</i></b> "+n,o.m_args=e,o.timeout=2e3,o.onerror=t.system.xhr.error,o.ontimeout=(()=>{}),o.onreadystatechange=t.system.xhr.change,o.open("POST","/",!0),o.overrideMimeType("application/json"),o.setRequestHeader("AFANASY",n.length),o.send(n)}},change:function(e){var r=4==this.readyState;if(r&&200!=this.status)return++nw_error_total,void(++nw_error_count>nw_error_count_max&&nw_connected&&(nw_connected=!1,t.system.error("Connection lost."),t.system.connection.lost()));if(r){var o=null,n=null;if(this.responseText&&this.responseText.length){try{o=JSON.parse(this.responseText),"<pre>"+JSON.stringify(o,void 0,2)+"</pre>"}catch(e){n=e}this.m_log+="<br /><b><i>recv:</i></b> "+this.responseText}t.system.log(this.m_log,"netlog"),nw_error_count=0,nw_connected=!0,localStorage.time_activity=Date.now()/1e3,this.responseText&&this.responseText.length&&(n&&(t.system.error("JSON.parse:"),t.system.log(n.message+"<br />"+this.responseText),o=null),o&&(this.m_args.func?this.m_args.func(o,this.m_args,e):t.system.g_ProcessMsg(o)))}},error:function(e){this.m_args.func&&this.m_args.func(null,this.m_args,e)}},windows:{text:(e,r,o)=>{var n=document.createElement("div");n.classList.add("selectable"),n.classList.add("text"),e=Array.isArray(e)?e:[e],Array.prototype.forEach.call(e,e=>{var t=document.createElement("p");t.innerHTML=e,n.appendChild(t)}),t.system.windows.confirm({html:n.outerHTML},r,o,!0)},confirm:(e,r,o,n,a)=>{"string"==typeof e&&(e=t.config.get("confirm."+e)),e.id=window.hmicrotime(),e.title=t.langs.get(r||(e.title||void 0)),e.subtitle=o||(e.subtitle||void 0),e.resize=n||(e.resize||void 0),e.callback=a||(e.callback||void 0),Array.isArray(e.callback)&&([e.button,e.callback]=e.callback);var s=t.tools.selected.window(),[l,i]=t.tools.selected.lines(":");l=l&&l.filter((e,t,r)=>r.indexOf(e)==t),i=i&&i.filter((e,t,r)=>r.indexOf(e)==t);var c=window.cell_create(t.templates.get("cell-confirm",e,!0),e.title,{autosize:!1,noattach:!0,noresize:!e.resize,subtitle:e.subtitle}),d=c.querySelector(".win input[type=text], .win textarea");d&&setTimeout(()=>{d.focus()},100);var u=c.querySelector('input[type="button"][name="confirm"]');return u&&(u.onmousedown=(r=>{var o=!1,n=!0;e.callback&&"function"==typeof t.functions[e.callback]&&(n=!(o=t.functions[e.callback](r,c,e,s,l,i))),n?window.cell_close(c.uid):void 0!==o&&console.log("callback:",o)}),d&&Array.prototype.forEach.call(c.querySelectorAll(".win input[type=text]"),e=>{e.onkeydown=(e=>{13==e.keyCode&&u.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))})})),c}},digest:{init:e=>{if(g_digest=null,g_auth.nc=0,e&&(g_auth.nonce=e.nonce,null==localStorage.digest||null==localStorage.realm||localStorage.realm!=e.realm||null==localStorage.user_name||localStorage.user_name.length<1))return t.system.digest.remove(),localStorage.realm=e.realm,void t.functions.login_user();g_digest=localStorage.digest,g_auth.user_name=localStorage.user_name,$("#auth_user").textContent=localStorage.user_name,t.system.config.get()},construct:(e,r)=>{localStorage.user_name=e,localStorage.digest=hex_md5(localStorage.user_name+":"+localStorage.realm+":"+r),t.system.digest.init()},remove:()=>{localStorage.removeItem("digest"),localStorage.removeItem("realm")}},check_block_flag:(e,t)=>cm_blockFlags[t]?cm_blockFlags[t]&e:(g_Error('Block flag "'+t+'" does not exist.'),g_Log("Valid flags are: "+JSON.stringify(cm_blockFlags)),!1),g_ProcessMsg:e=>{if(g_last_msg_cycle=g_cycle,e.realm)t.system.error("Authentication problems...");else if(e.files&&e.path)for(var r=0;r<e.files.length;++r){(new Image).src="/"+e.path+"/"+e.files[r]}else if(e.monitor)0==g_id&&e.monitor.id>0?t.system.register.receive(e.monitor):e.monitor.id!=g_id&&(t.system.info("This ID = "+g_id+" != "+e.monitor.id+" received."),t.system.register.unset());else if(e.message||e.info||e.object)t.system.g_ShowObject(e);else{if(e.events&&e.events.tasks_outputs&&e.events.tasks_outputs.length)for(r=0;r<e.events.tasks_outputs.length;++r)t.system.WndTaskShow({task:e.events.tasks_outputs[r]});if(e.events&&e.events.tasks_listens&&e.events.tasks_listens.length)for(r=0;r<e.events.tasks_listens.length;++r)t.system.WndTaskShow({task:e.events.tasks_listens[r]});if(0!=g_id)for(r=0;r<g_receivers.length;++r)g_receivers[r].processMsg(e)}},wt_same:(e,t)=>!(e.pos.job!=t.pos.job||e.pos.block!=t.pos.block||e.pos.task!=t.pos.task),WndTaskShow:e=>{var r=e.task;null==r&&t.system.error("WndTaskShow: Task is NULL.");for(var o=0;o<wt_windows.length;++o)t.system.wt_same(wt_windows[o],r)&&wt_windows[o].show(r)},g_ShowObject:(e,r)=>{if(e.info)"log"==e.info.kind?t.system.log(e.info.text):"error"==e.info.kind?t.system.error(e.info.text):t.system.info(e.info.text);else{var o=e,n="object";e.object?o=e.object:e.message&&(o=e.message,n="message",t.system.info("Message received.")),null==r&&(r={});var a="Object";o.name&&(a=o.name),r.name&&(a=r.name),o.type&&(a+=" "+o.type),r.title=a;var s=g_OpenWindow(r);if("message"==n)for(var l=0;l<o.list.length;++l){var i;(i=document.createElement("p")).innerHTML=o.list[l].replace(/\n/g,"<br/>"),s.elContent.appendChild(i)}else(i=document.createElement("p")).innerHTML=JSON.stringify(o,null,"&nbsp&nbsp&nbsp&nbsp").replace(/\n/g,"<br/>"),s.elContent.appendChild(i)}},g_VISOR:()=>localStorage.visor||g_uid<1,g_GOD:()=>localStorage.god||g_uid<1,g_CloseAllWindows:()=>{for(var e=0;e<g_windows.length;e++)g_windows[e].close()},g_CloseAllMonitors:()=>{for(cgru_ClosePopus();g_monitors.length>0;)g_monitors[0].destroy()},g_MButtonClicked:(e,r)=>{for(var o=0;o<g_monitor_buttons.length;++o)if(g_monitor_buttons[o].textContent==e){if(g_monitor_buttons[o].classList.contains("pushed"))return;g_monitor_buttons[o].classList.add("pushed")}t.system.g_OpenMonitor({type:e,evt:r})},g_OpenMonitor:e=>{null==e.name&&(e.name=e.type),null==e.wnd&&(e.wnd=window);for(var r=e.evt&&(e.evt.shiftKey||e.evt.ctrlKey||e.evt.altKey),o=0;o<g_monitors.length;++o)if(g_monitors[o].name==e.name)return t.system.info('Monitor "'+e.name+'" already opened.',!1),void g_monitors[o].window.focus();if(e.elParent=$("#grid"),"tasks"!=e.type||r)if(r){if(e.wnd=t.system.g_OpenWindowWrite(e.name),null==e.wnd)return;e.elParent=e.wnd.document.body}else g_main_monitor&&g_main_monitor.destroy();else g_TopWindow&&g_TopWindow.destroy(),(g_TopWindow=new cgru_Window({name:"tasks",title:e.name,wnd:e.wnd,closeOnEsc:!1,addClasses:["cgru_absolute","tasks"]})).closeOnEsc=!1,g_TopWindow.onDestroy=(()=>{g_TopWindow.monitor.destroy(),g_TopWindow=null}),e.elParent=g_TopWindow.elContent;return r?(e.wnd.monitor=!1,e.wnd.onbeforeunload=(e=>{e.currentTarget.monitor.destroy()})):"tasks"==e.type?g_TopWindow.monitor=!1:(g_main_monitor=!1,g_main_monitor_type=e.type,localStorage.main_monitor=e.type),!1},g_OpenWindowWrite:(e,r,o)=>{null==r&&(r=e);for(var n=0;n<g_windows.length;++n)g_windows[n].name==e&&g_windows[n].close();var a=window.open(null,e,"location=no,scrollbars=yes,resizable=yes,menubar=no");if(null!=a)return g_windows.push(a),a.name=e,a.document.writeln("<!DOCTYPE html>"),a.document.writeln("<html><head><title>"+r+"</title>"),a.document.writeln('<link type="text/css" rel="stylesheet" href="lib/styles.css">'),a.document.writeln('<link type="text/css" rel="stylesheet" href="afanasy/browser/style.css">'),null!=o&&0!=o||(a.document.writeln("</head><body></body></html>"),a.document.body.onkeydown=g_OnKeyDown),a.document.body&&(localStorage.background&&(a.document.body.style.background=localStorage.background),localStorage.text_color&&(a.document.body.style.color=localStorage.text_color)),a.focus(),a.document.close(),a;t.system.error("Can`t open new browser window.")},g_Init:()=>{t.system.info("HTML body load."),cgru_Init(),t.system.cm_Init(),window.onbeforeunload=t.system.g_OnClose,document.body.onkeydown=t.system.g_OnKeyDown,localStorage.main_monitor&&(g_main_monitor_type=localStorage.main_monitor),g_monitor_buttons=[];for(var e=0;e<g_monitor_buttons.length;++e)g_monitor_buttons[e].onclick=(e=>t.system.g_MButtonClicked(e.currentTarget.textContent,e));t.system.config.get()},g_OnKeyDown:e=>{if(e){var r=t.tools.selected.window();if(27==e.keyCode)return r&&r.parentNode.parentNode===document.body&&window.cell_close(r.parentNode.uid);if(!cgru_DialogsAll.length&&!cgru_MenusAll.length){if(65==e.keyCode&&e.ctrlKey)return r&&t.functions.win_select_all(),!1;38==e.keyCode&&r?t.functions.win_select_next(e,!0):40==e.keyCode&&r&&t.functions.win_select_next(e,!1),(g_keysdown+=String.fromCharCode(e.keyCode)).length>5&&(g_keysdown=g_keysdown.slice(g_keysdown.length-5,g_keysdown.length)),t.system.check_sequence()}}},check_sequence:()=>{var e="IDDQD"==g_keysdown,r=!1;0==(r=!!e||"IDKFA"==g_keysdown)&&0==e||(localStorage.visor?(localStorage.removeItem("visor"),localStorage.removeItem("god"),t.system.info("USER MODE"),g_uid=g_uid_orig):e?(localStorage.god=!0,t.system.info("GOD MODE")):r&&(localStorage.visor=!0,t.system.info("VISOR MODE")),t.system.register.super())},config:{get:()=>{t.system.xhr.send({get:{type:"config"}},t.system.config.received)},received:e=>{if(e.realm)return g_digest?(t.system.error("Access denied."),void t.system.digest.remove()):void t.system.digest.init(e);if(e.cgru_config){if(!cgru_ConfigLoad(e.cgru_config))return void t.system.error("Invalid config received.");cgru_Config.docs_url&&($("#docs_link").href=cgru_Config.docs_url+"/afanasy/gui#web"),cgru_Config.forum_url&&($("#forum_link").href=cgru_Config.forum_url+"/viewforum.php?f=17");var r=cgru_Environment.username+"@"+cgru_Environment.hostname+":"+cgru_Environment.location,o="CGRU version: "+cgru_Environment.version;o+="<br>Build at: "+cgru_Environment.builddate,o+="<br>Build revision: "+cgru_Environment.buildrevision,o+="<br>Server: "+r,cgru_Environment.servedir&&cgru_Environment.servedir.length&&(o+="<br>HTTP root override: "+cgru_Environment.servedir),t.system.log(o);var n=document.querySelector(".infos-cgru");n.textContent=":"+cgru_Environment.version,n.setAttribute("title",r),document.querySelector(".infos-server").textContent=r}null==g_digest&&cgru_params.push(["user_name","User Name","coord","Enter user name<br/>Need restart (F5)"]),cgru_params.push(["host_name","Host Name","pc","Enter host name<br/>Needed for logs only"]),cgru_params.push(["run_symbol","Run Symbol","★",'Enter any <a href="http://en.wikipedia.org/wiki/Miscellaneous_Symbols" target="_blank">unicode</a><br/>You can copy&paste some:<br>★☀☢☠☣☮☯☼♚♛♜☹♿⚔☻⚓⚒⚛⚡⚑☭']),cgru_ConstructSettingsGUI(),cgru_InitParameters(),cgru_Info=t.system.info,cgru_Error=t.system.error,t.system.cm_ApplyStyles(),t.system.nw_GetSoftwareIcons(),t.system.register.set(),t.system.g_Refresh()}},g_Refresh:()=>{if(null!=g_last_msg_cycle&&g_last_msg_cycle<g_cycle-10&&t.system.connection.lost(),++g_cycle,setTimeout(t.system.g_Refresh,1e3),0!=g_id){t.system.nw_GetEvents("monitors","events");for(var e=0;e<g_refreshers.length;++e)g_refreshers[e].refresh()}},nw_GetEvents:()=>{if(0!=g_id){var e={get:{ids:[g_id],mode:"events",type:"monitors"}};t.system.xhr.send(e)}},nw_GetSoftwareIcons:()=>{t.system.xhr.send({get:{type:"files",path:"icons/software"}})},cm_Init:()=>{null==localStorage.ui_level&&(localStorage.ui_level=cm_UILevels[0]),localStorage.ui_level==cm_UILevels[2]&&t.system.info("Welcome to the Dark Side.")},g_OnClose:()=>{localStorage.main_monitor=g_main_monitor_type;var e={type:"deregister"};g_id&&t.system.action.send("monitors",[g_id],e),g_closing=!0,t.system.g_CloseAllWindows(),t.system.g_CloseAllMonitors()},cm_ApplyStyles:()=>{document.body.style.background=localStorage.background,document.body.style.color=localStorage.text_color},ui_level:{padawan:()=>0==cm_UILevels.indexOf(localStorage.ui_level),jedi:()=>1==cm_UILevels.indexOf(localStorage.ui_level),sith:()=>2==cm_UILevels.indexOf(localStorage.ui_level),apply:e=>{$("#ui_level");if(-1==cm_UILevels.indexOf(e))return t.system.error("Invalid UI Level: "+e);t.system.info("UI level set: "+e),localStorage.ui_level!=e&&(localStorage.ui_level=e)}}},window.g_Log=t.system.log,Handlebars.registerHelper("config",function(e){return t.config.get(e)}),Handlebars.registerHelper("trans",function(e){return new Handlebars.SafeString(t.langs.get(e))});var r=e=>{alert("Error loading configuration !"),console.error(e)};t.tools.ajax(t.global.source+"config.txt",{input:"json"},(e,o)=>{if(t.config=Object.assign(o,t.config),t.config.source=t.global.source,"object"==typeof t.config.langs){var n=[];Array.prototype.forEach.call(Object.keys(t.config.langs),e=>{var r=t.config.langs[e];r.name&&(t.langs[e]=r,n.push([e,r.name]))}),t.langs.default=t.config.langs.default,delete t.config.langs,t.langs.selected in t.langs||(t.langs.selected=t.langs.default)}t.tools.ajax(t.global.source+"templates.txt",{input:"html"},(e,r)=>{Array.prototype.forEach.call(r.querySelectorAll("ajax > [handlebars]"),e=>{var r=e.getAttribute("handlebars"),o=e.innerHTML.replace(/({{&gt;)/g,"{{>").replace(/({{#&gt;)/g,"{{#>");r.indexOf("partial-")?t.templates.all[r]=Handlebars.compile(o):Handlebars.registerPartial(r.substr("partial-".length),o)}),t.tools.handlebars(document.body);var o=document.querySelector("#statusbar .update > .time");setInterval(()=>{var e="s",t=Date.now()/1e3-(localStorage.time_activity||0);t>=60&&(t>86400&&(e="j")?t/=86400:t>3600&&(e="h")?t/=3600:(e="m")&&(t/=60)),o.textContent=Math.max(0,Math.floor(t))+e},500),document.body.classList.remove("loading"),document.dispatchEvent(t),Array.prototype.forEach.call(t.global.grid_filling,e=>{var r=t.templates.get("cell-"+e.type,!1,!0);window.cell_create(r,!1,e)}),"function"==typeof window.table_resize&&window.table_resize(),t.system.g_Init(),setInterval(window.cell_refresh,250),Array.prototype.forEach.call(document.querySelectorAll(".menu.main-toolbar > li[onclick-function]"),e=>{var r=e.getAttribute("onclick-function");try{if(r=JSON.parse(r),"function"!=typeof t.functions[r[0]])throw""}catch(e){r=!1}"function"==typeof t.functions[r[0]]&&(e.onmousedown=(o=>{t.functions[r[0]].apply(e,[o,...r.slice(1)])}))})},r)},r)});var set_values={},date_null=[null,"","0000-00-00","0000-00-00 00:00:00"];Array.prototype.forEach.call([["log",function(){console.log(...Array.prototype.slice.call(arguments,0,-1))}],["concat",function(){return Array.prototype.slice.call(arguments,0,-1).join("")}],["upper",function(){return arguments[0].toUpperCase()}],["lower",function(){return arguments[0].toLowerCase()}],["capitalize",function(){return arguments[0].capitalize()}],["eq",function(){return arguments[0]===arguments[1]}],["not-eq",function(){return arguments[0]!==arguments[1]}],["not",function(){return!arguments[0]}],["and",function(){return arguments[0]&&arguments[1]}],["or",function(){return arguments[0]||arguments[1]}],["xor",function(){return arguments[0]&&!arguments[1]||!arguments[0]&&arguments[1]}],["gt",function(){return arguments[0]>arguments[1]}],["gte",function(){return arguments[0]>=arguments[1]}],["lt",function(){return arguments[0]<arguments[1]}],["lte",function(){return arguments[0]<=arguments[1]}],["in",function(){return("string"==typeof arguments[1]?JSON.parse(arguments[1]):arguments[1]).indexOf(arguments[0])>=0}],["not-in",function(){return arguments[1].indexOf(arguments[0])<0}],["type",function(){return typeof arguments[0]}],["count",function(){return"object"==typeof arguments[0]?Array.isArray(arguments[0])?arguments[0].length:Object.keys(arguments[0]).length:0}],["is-array",function(){return Array.isArray(arguments[0])}],["date-null",function(){return date_null.indexOf(arguments[0])>=0}],["join",function(){return arguments[0].join(arguments[1])}],["split",function(){return arguments[0].split(arguments[1])}],["slice",function(){return arguments[0].slice(arguments[1],arguments.length>3?arguments[2]:void 0)}],["array",function(){return Array.prototype.slice.call(arguments,0,-1)}],["array-get",function(){return arguments[1][arguments[0]]}],["array-add",function(){return arguments[0].concat(Array.prototype.slice.call(arguments,1,-1))}],["array-concat",function(){return arguments[0].concat(arguments[1])}],["atob",function(){return atob(arguments[0])}],["btoa",function(){return btoa(arguments[0])}],["encode",function(){return unescape(encodeURIComponent(arguments[0]))}],["decode",function(){var e=arguments[0];try{e=decodeURIComponent(escape(e))}catch(e){}return e}],["json-parse",function(){return JSON.parse(arguments[0])}],["json-string",function(){return JSON.stringify(arguments[0])}],["keys",function(){return Object.keys(arguments[0])}],["get",function(){var e=set_values,t=Array.prototype.slice.call(arguments,0,-1);return"object"==typeof arguments[0]&&(t.shift(),e=arguments[0]),Array.prototype.forEach.call(t,t=>{e=e[t]}),e}],["set",function(){"object"==typeof arguments[1]&&arguments[1].hash?arguments[1]=arguments[1].hash:"json"===arguments[2]&&(arguments[1]=JSON.parse(arguments[1])),set_values[arguments[0]]=arguments[1]}],["merge",function(){var e={};return arguments[0]=arguments[0]||{},"string"==typeof arguments[0]&&(arguments[0]=JSON.parse(arguments[0])),arguments[1]=arguments[1]||{},"string"==typeof arguments[1]&&(arguments[1]=JSON.parse(arguments[1])),Array.prototype.forEach.call(Object.keys(arguments[0]),t=>{e[t]=arguments[0][t]}),Array.prototype.forEach.call(Object.keys(arguments[1]),t=>{e[t]=arguments[1][t]}),e}]],e=>{e=e;Handlebars.registerHelper(e[0],function(){try{return e[1](...arguments)}catch(t){console.error(e[0],arguments,t)}return""})}),Handlebars.registerHelper("tag",function(e){var t="";return Array.prototype.forEach.call(Array.prototype.slice.call(arguments,1,-1),e=>{e&&"object"==typeof e&&(e.hash&&(e=e.hash),Array.prototype.forEach.call(Object.keys(e),r=>{t+=" "+r+"=",e[r].indexOf('"')>=0?t+="'"+e[r]+"'":t+='"'+e[r]+'"'}))}),new Handlebars.SafeString("<"+e+t+">")});var g_cycle=0,g_last_msg_cycle=g_cycle,g_id=0,g_uid=-1,g_uid_orig=-1,g_keysdown="",g_closing=!1,g_auth={},g_digest=null,g_windows=[],g_receivers=[],g_refreshers=[],g_monitors=[],g_cur_monitor=null,g_main_monitor=null,g_main_monitor_type="jobs",g_monitor_buttons=[],g_TopWindow=null,g_HeaderOpened=!1,g_FooterOpened=!1,g_Images=[],cm_UILevels=["Padawan","Jedi","Sith"],cm_blockFlags={numeric:1,varCapacity:2,multiHost:4,masterOnSlave:8,dependSubTask:16,skipThumbnails:32,skipExistingFiles:64,checkRenderedFiles:128},nw_connected=!1,nw_error_count=0,nw_error_count_max=5,nw_error_total=0;$={},$prototypes={path:function(e){if(!(this instanceof $))return $._args("path",arguments);for(var t=[],r=e[0];r&&r.parentNode&&r.parentNode!==document.querySelector("html");)r=r.parentNode,t.push(r);return t},parent:function(e,t,r){if(!(this instanceof $))return $._args("parent",arguments);if(arguments.length<=1||!e.length)return e.length&&e[0].parentNode;var o=!1,n=e[0],a=t instanceof Node||t instanceof HTMLElement,s=!1;return Array.prototype.forEach.call($.path(n),e=>{o||s||(a&&e===t||!a&&e.matches(t)?s=e:r&&e===r&&(o=!0))}),s}},$=Object.assign(function(){if(this.constructor!=$)return new $(...arguments);var e=arguments[0];"string"==typeof e?e=document.querySelectorAll(e):Array.isArray(e)||e instanceof NodeList||(e=[e]);var t=0,r=e.length?e[0]:{};Array.prototype.forEach.call(e,e=>{r[t++]=e}),r.length=t;var o=this;return Array.prototype.forEach.call(Object.keys($prototypes),t=>{r[t]=function(){return $prototypes[t].apply(o,[e].concat(Array.prototype.slice.call(arguments)))}}),r},$prototypes,{_args:function(e,t){return $(t[0])[e](...Array.prototype.slice.call(t,1))}}),Object.defineProperty(String.prototype,"capitalize",{value:function(){var e=this.valueOf();return e.charAt(0).toUpperCase()+e.slice(1)}}),Object.defineProperty(String.prototype,"replaceArr",{value:function(e){for(var t=this.valueOf(),r=0;r<e.length;++r)t=t.replace("%"+(r+1),e[r]);return t}}),Object.defineProperty(String.prototype,"toClipboard",{value:function(e,t){var r=this.valueOf(),o=document.createElement("textarea");o.setAttribute("style","position: fixed; top: -50px; left: -50px; width: 42px; height: 42px;"),o.value=r,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}}),Object.defineProperty(Number.prototype,"toDate",{value:function(e){var t=this.valueOf();if(!t&&void 0!==e)return e;t<1e10&&(t*=1e3);var r=new Date(t);return r.getFullYear()+"/"+("0"+(r.getMonth()+1)).slice(-2)+"/"+("0"+r.getDate()).slice(-2)+" "+(("0"+r.getHours()).slice(-2)+":"+("0"+r.getMinutes()).slice(-2)+":"+("0"+r.getSeconds()).slice(-2))}}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var[t,r]=[e.global,e.templates],o=document.querySelector("#grid"),n=(e,r,n,a)=>{var s=window.getComputedStyle(o,null),l={x:[],y:[]};if(!0===e||"x"==e&&Array.isArray(r))if(a=!0,!0===e)for(var i=100/t.grid_size.x,c=1;c<=t.grid_size.x;++c)l.x.push(i);else l.x=r;else if("x"==e&&r&&n){var d=parseInt(s.getPropertyValue("width"));Array.prototype.forEach.call(t.grid_template.x,(e,t)=>{t+1==r?e+=n/d*100:t==r&&(e-=n/d*100),l.x[t]=e})}else l.x=t.grid_template.x;if(o.style.gridTemplateColumns=l.x.join("% ")+"%",!0===e||"y"==e&&Array.isArray(r))if(a=!0,!0===e){i=100/t.grid_size.y;for(var u=1;u<=t.grid_size.y;++u)l.y.push(i)}else l.y=r;else if("y"==e&&r&&n){d=parseInt(s.getPropertyValue("height"));Array.prototype.forEach.call(t.grid_template.y,(e,t)=>{t+1==r?e+=n/d*100:t==r&&(e-=n/d*100),l.y[t]=e})}else l.y=t.grid_template.y;return o.style.gridTemplateRows=l.y.join("% ")+"%",a&&(t.grid_template=l,t.grid_size.x=t.grid_template.x.length,t.grid_size.y=t.grid_template.y.length),l};n(!0);var a=!1;window.dmousedown.grid_resize=(e=>{if(e.target.classList.contains("rule")){var t=e.target,r=t.parentNode,o=(t.getAttribute("grid-type"),t.getAttribute("grid-position")),n=window.getComputedStyle(r,null),s=parseInt(n.getPropertyValue("width"));a={rule:t,cell:r,position:e["client"+o.toUpperCase()],size:s,template:!1},window.getSelection().removeAllRanges()}}),window.dmousemove.grid_resize=(e=>{if(a){var t=a.rule,r=a.cell,o=t.getAttribute("grid-index"),s=t.getAttribute("grid-type"),l=t.getAttribute("grid-position"),i=(r.parentNode.querySelector('.rule[grid-type="'+s+'"][grid-index="'+(o+1)+'"]'),e["client"+l.toUpperCase()]-a.position);a.template=n(l,o,i),window.getSelection().removeAllRanges()}}),window.dmouseup.grid_resize=(e=>{a&&a.template&&(t.grid_template=a.template),a=!1}),window.dmousedown.grid_edit=(r=>{var o=r.target;if((r.target.classList.contains("grid-edit")||(o=$.parent(r.target,".grid-edit")))&&!o.classList.contains("disabled")){var a=t.grid_template,s=o.getAttribute("grid-edit"),l=o.getAttribute("grid-position");if("add"==s){var i=1/(c=a[l].length+1)*100;Array.prototype.forEach.call(a[l],(e,t)=>{a[l][t]-=i/(c-1)}),a[l].push(i)}if("remove"==s&&a[l].length>1){var c=a[l].length-1;i=a[l].pop();Array.prototype.forEach.call(a[l],(e,t)=>{a[l][t]+=i/c}),Array.prototype.forEach.call(document.querySelectorAll("#grid > .cell"),e=>{var t=e.getAttribute("grid-x"),r=e.getAttribute("grid-y");(t>a.x.length||r>a.y.length)&&e.parentNode.removeChild(e)})}n(l,a[l]),e.system.lock_refresh()}}),window.dmousedown.cell_active=(e=>{var r=$.parent(e.target,".cell[data-uid]");if(r&&!e.target.classList.contains("lines")&&!$.parent(e.target,".lines")){var o=r.uid;if(t.cell_active!=o){var n=$.parent(r,"#grid");Array.prototype.forEach.call(document.querySelectorAll(".cell"),e=>{if(e.classList.remove("active"),!n){var t=Number.parseInt(e.style.zIndex);e.parentNode!==document.body||Number.isNaN(t)||(e.style.zIndex=--t?t:"")}}),t.cell_active=o,r.classList.add("active"),r.style.zIndex=n?"":100}}});var s={Jobs:!1,Logs:!1,Monitors:!1,Renders:!1,Tasks:!1,Users:!1};window.cell_refresh=(r=>{!(r=["boolean","string"].indexOf(typeof r)>=0&&r)&&document.hidden||(uid=t.cell_active,r="string"==typeof r?r.toLowerCase():r,Array.prototype.forEach.call(Object.keys(s),t=>{if(!s[t]){s[t]=!0;var o=t+"Node",n=t.toLowerCase(),a=".win[cell-type="+n+"]",l=document.querySelectorAll(a),i=document.querySelector('.cell.active[data-uid="'+uid+'"] '+a);if("function"==typeof window[o]){l.length&&n in e.global.nodes_data||(e.global.nodes_data[n]={});try{window[o](l,!0===r||r===n,!!i).then(e=>{Array.prototype.forEach.call(l,t=>{t.parentNode.querySelector(".title .refresh").style.opacity=e.refresh?1:0})}).catch(e=>{e&&console.error("catch:",e)}).finally(()=>{s[t]=!1})}catch(e){}}}}))}),window.cell_create=((e,n,a)=>{a=Object.assign({subtitle:!1,autosize:!0,noattach:!1,noresize:!1,nl2br:!1,style:"",position:!1,size:!1},a||{});var s=r.get("cell-container",!1,!0);s.uid=window.hmicrotime();var l=document.createElement("div");l.classList.add("win");var i=!1;if(e instanceof HTMLElement)if(e.classList.contains("win")){if((l=e).removeAttribute("data-template"),!n){i=l.querySelector(":scope > .title");var c=l.getAttribute("cell-title");!i&&c&&(n="string"==typeof c&&c?c:n)}var d=l.querySelector(":scope > [data-buttons]");if(d){var u=s.querySelector(".buttons");"add"!==d.getAttribute("data-buttons")&&Array.prototype.forEach.call(u,e=>{e.remove()}),d.parentNode.removeChild(d),Array.prototype.forEach.call(Object.keys(d.childNodes).reverse(),e=>{u.prepend(d.childNodes[e])})}var p=l.querySelector(":scope > .subtitle")||document.createElement("div");p.parentNode?(l.classList.add("decal"),p.parentNode.removeChild(p)):p.classList.add("subtitle"),s.querySelector(":scope > .title").after(p);var y="string"==typeof a.style?a.style:"";y+=y.trim()&&";"!==y.trim().slice(-1)?";":"",y+="string"==typeof l.getAttribute("style")?l.getAttribute("style"):"",l.removeAttribute("style"),s.setAttribute("style",y)}else l.appendChild(e);else{if("string"!=typeof e)return!1;a.nl2br&&(e=e.replace(/\n/g,"<br />"));var m=document.createElement("span");m.classList.add("text"),m.innerHTML=e,l.classList.add("text-center"),l.appendChild(m)}if("1"===l.getAttribute("data-generate"))return!1;l.setAttribute("data-generate","1"),i?s.querySelector(".title").replaceWith(i):(i=s.querySelector(".title"),n&&(i.querySelector(".text").innerText=n)),"string"==typeof a.subtitle&&a.subtitle.trim()&&(s.querySelector(".title .subtext").textContent=" - "+a.subtitle);var g=!a.position||l.getAttribute("data-template");g?(s.setAttribute("grid-x",a.position.x||1),s.setAttribute("grid-y",a.position.y||1),s.setAttribute("grid-width",a.size.width||1),s.setAttribute("grid-height",a.size.height||1),a.autosize&&(s.style.width=t.cell_width+"px",s.style.height=t.cell_height+"px")):(l.replaceWith(s),a.size=a.size?a.size:{width:1,height:1},s.setAttribute("grid-x",a.position.x),s.setAttribute("grid-y",a.position.y),s.setAttribute("grid-width",a.size.width),s.setAttribute("grid-height",a.size.height),s.style.gridColumn=a.position.x+" / span "+a.size.width,s.style.gridRow=a.position.y+" / span "+a.size.height),s.querySelector(".win").replaceWith(l),g?window.dmousedown.cell_detach(s,!0):o.appendChild(s);var f=s.querySelectorAll("[tab-target]");Array.prototype.forEach.call(f,e=>{var t=e.getAttribute("tab-target");e.onmousedown=(()=>{Array.prototype.forEach.call(f,e=>{var r=e.getAttribute("tab-target"),o=r==t;s.querySelector('[tab-id="'+r+'"]').classList[o?"add":"remove"]("active"),e.classList[o?"add":"remove"]("active")})})}),Array.prototype.forEach.call(s.querySelectorAll(".subtitle .graph"),e=>{var t=l.querySelector(":scope > .frame.frame-first"),r=l.querySelector(":scope > .frame.frame-circ");if(t&&r){e.onmousedown=(o=>{var n=!e.classList.contains("active");e.classList.toggle("active"),t.style.display=n?"none":"block",r.style.display=n?"block":"none"})}}),Array.prototype.forEach.call(s.querySelectorAll(".subtitle [show-lateral]"),e=>{var t=l.querySelector(":scope > .frame.frame-lateral"),r=t.querySelector(':scope > [lateral="'+e.getAttribute("show-lateral")+'"]');if(t&&r){e.onmousedown=(o=>{l.classList.toggle("show-lateral");var n=l.classList.contains("show-lateral");e.classList.contains("icon")&&e.classList.toggle("active",n),Array.prototype.forEach.call(t.children,e=>{e.classList.remove("active")}),r.classList.add("active")})}}),Array.prototype.forEach.call(s.querySelectorAll("[col-storage]"),e=>{var t=e.getAttribute("col-storage"),r=localStorage[t+"_cols"];r&&e.setAttribute("col-hides",r)}),Array.prototype.forEach.call(s.querySelectorAll(".close"),e=>{e.onmousedown=(e=>{s.remove()})}),s.setAttribute("data-uid",s.uid);var _=new MouseEvent("mousedown",{bubbles:!0});return l.dispatchEvent(_),a.autosize||setTimeout(()=>{var e=window.getComputedStyle(s,null),t=Math.min(parseInt(e.getPropertyValue("width")),document.body.offsetWidth-50),r=Math.min(parseInt(e.getPropertyValue("height")),document.body.offsetHeight-100);s.style.width=t+"px",s.style.height=r+"px"},100),s}),window.dmousedown.cell_detach=((e,r)=>{var o=e;if(e&&e.target&&(o=e.target.classList.contains("detach")||$.parent(e.target,".detach")?$.parent(e.target,".cell"):o),o instanceof HTMLElement||o instanceof Node){var n=window.getComputedStyle(o,null),a=Math.min(parseInt(n.getPropertyValue("width")),document.body.offsetWidth-50),s=Math.min(parseInt(n.getPropertyValue("height")),document.body.offsetHeight-100);o.parentNode&&o.parentNode.removeChild(o);var l=o.querySelector(".win").getAttribute("cell-type");if(l&&localStorage[l+"_size"]){var i=localStorage[l+"_size"].split(":");o.style.width=i[0]+"px",o.style.height=i[1]+"px"}else o.style.width=a+"px",o.style.height=s+"px";document.body.appendChild(o);var c=t.cell_increment++,d=o.offsetTop+25*c,u=o.offsetLeft+25*c;(document.body.offsetHeight<d+t.cell_height||document.body.offsetwidth<u+t.cell_width)&&(c=t.cell_increment=0),o.style.top=o.offsetTop+25*c+"px",o.style.left=o.offsetLeft+25*c+"px"}});var l=!1;window.dmousedown.cell_move=(e=>{var t=$.parent(e.target,".cell");if((!document.body.classList.contains("locked")||t.parentNode===document.body)&&e.target.matches(".cell > .title, .cell > .title > *:not(.icon)")){var r=t.parentNode;t.style.opacity=.8;var n,a,s=o.getBoundingClientRect(),i=t.getBoundingClientRect();r===document.body?(a=i,n={x:e.clientX-i.x,y:e.clientY-i.y}):(a=s,n={x:(e.clientX-(i.x-s.x))/i.width,y:(e.clientY-(i.y-s.y))/i.height}),l={parent:r,cell:t,base:a,diff:n},window.getSelection().removeAllRanges()}}),window.dmousemove.cell_move=(e=>{if(l){var r=l.cell,n=l.parent,a=l.base,s=l.diff,i=parseInt(r.getAttribute("grid-width")),c=parseInt(r.getAttribute("grid-height")),d={x:1,y:1},u=e.clientX-a.x,p=e.clientY-a.y;if(n===document.body)r.style.top=p-s.y+a.y+"px",r.style.left=u-s.x+a.x+"px",Array.prototype.forEach.call(o.querySelectorAll(".empty-cell"),t=>{var r=t.getBoundingClientRect(),o=r.x<e.clientX&&r.width+r.x>e.clientX,n=r.y<e.clientY&&r.height+r.y>e.clientY;t.classList.toggle("active",e.ctrlKey&&o&&n)});else{for(var y=0,m=1;m<=t.grid_size.x;++m){for(var g=0,f=m;f<m+i&&f<=t.grid_size.x;++f)g+=t.grid_template.x[f-1]/100*a.width;var _=t.grid_template.x[m-1]/100*a.width;if(u-g/3<y)break;d.x=m,y+=_}y=0;for(var b=1;b<=t.grid_size.y;++b){_=t.grid_template.y[b-1]/100*a.height;if(p<y)break;d.y=b,y+=_}r.style.gridArea=d.y+" / "+d.x+" / span "+c+" / span "+i,r.setAttribute("grid-x",d.x),r.setAttribute("grid-y",d.y)}window.getSelection().removeAllRanges()}}),window.dmouseup.cell_move=(e=>{if(l){var t=l.cell;if(t.style.opacity=null,e.ctrlKey){var r=o.querySelector(".empty-cell.active");if(r){var n=parseInt(r.getAttribute("grid-x")),a=parseInt(r.getAttribute("grid-y")),s=parseInt(t.getAttribute("grid-width")),i=parseInt(t.getAttribute("grid-height"));t.parentNode.removeChild(t),t.style.top=null,t.style.left=null,t.style.width=null,t.style.height=null,t.style.gridArea=a+" / "+n+" / span "+i+" / span "+s,o.prepend(t)}}Array.prototype.forEach.call(o.querySelectorAll(".empty-cell"),e=>{e.classList.remove("active")}),l=!1}});var i=!1;window.dmousedown.cell_resize=(e=>{if((!document.body.classList.contains("locked")||e.target.parentNode.parentNode===document.body)&&e.target.classList.contains("resize")){var t=e.target.parentNode,r=t.parentNode;t.style.opacity=.8;var n,a,s=e.target.getBoundingClientRect(),l=t.getBoundingClientRect(),c=o.getBoundingClientRect();if(r===document.body){var d=window.getComputedStyle(o,null),u=parseInt(d.getPropertyValue("bottom")),p=parseInt(d.getPropertyValue("right"));a=l,n={x:"number"==typeof p?-(p-s.width/2):0,y:"number"==typeof u?-(u+s.height):0}}else a=c,n={x:(e.clientX-(l.x-c.x))/l.width,y:(e.clientY-(l.y-c.y))/l.height};i={parent:r,cell:t,base:a,diff:n},window.getSelection().removeAllRanges()}}),window.dmousemove.cell_resize=(e=>{if(i){var r=i.cell,o=i.parent,n=i.base,a=i.diff,s=parseInt(r.getAttribute("grid-x")),l=parseInt(r.getAttribute("grid-y")),c={width:1,height:1},d=e.clientX-n.x,u=e.clientY-n.y;if(o===document.body)r.style.width=d+a.x+"px",r.style.height=u+a.y+"px";else{for(var p=0,y=1;y<=t.grid_size.x;++y){var m=t.grid_template.x[y-1]/100*n.width;if(d<p)break;c.width=y+1-s,p+=m}p=0;for(var g=1;g<=t.grid_size.y;++g){m=t.grid_template.y[g-1]/100*n.height;if(u<p)break;c.height=g+1-l,p+=m}c.width=Math.max(1,c.width),c.height=Math.max(1,c.height),r.style.gridArea=l+" / "+s+" / span "+c.height+" / span "+c.width,r.setAttribute("grid-width",c.width),r.setAttribute("grid-height",c.height)}window.getSelection().removeAllRanges()}}),window.dmouseup.cell_resize=(e=>{if(i){var t=i.cell;t.style.opacity=1;var r=t.querySelector(".win").getAttribute("cell-type");t.parentNode===document.body&&r&&"confirm"!=r&&(localStorage[r+"_size"]=t.offsetWidth+":"+t.offsetHeight),i=!1}}),window.cell_search=(e=>{var t=!1;return Array.prototype.forEach.call(document.querySelectorAll(".cell"),r=>{r.getAttribute("data-uid")===e&&(t=r)}),t}),window.cell_close=(e=>{var t=window.cell_search(e);if(t){var r=t.querySelector(".close");r&&"function"==typeof r.onmousedown?r.onmousedown():t.remove()}}),n()});var add_event=(e,t)=>{Array.prototype.forEach.call(Object.keys(t),r=>{try{var o=!1;try{"object"==typeof t[r]&&(add_event(e,t[r]),o=!0)}catch(e){}o||t[r](e)}catch(e){}})};window.dresize={},window.addEventListener("resize",e=>{add_event(e,window.dresize)}),window.dmousedown={},window.addEventListener("mousedown",e=>{add_event(e,window.dmousedown)}),window.dmousemove={},window.addEventListener("mousemove",e=>{add_event(e,window.dmousemove)}),window.dmouseup={},window.addEventListener("mouseup",e=>{add_event(e,window.dmouseup)}),window.dkeydown={},window.addEventListener("keydown",e=>{add_event(e,window.dkeydown)}),window.dkeyup={},window.addEventListener("keyup",e=>{add_event(e,window.dkeyup)}),window.dmutation={},window.addEventListener("DOMContentLoaded",e=>{new MutationObserver(function(e){add_event(e,window.dmutation)}).observe(document.body,{childList:!0})}),window.addEventListener("contextmenu",e=>(e.preventDefault(),!1)),document.addEventListener("DOMContentLoadedAfanasy",e=>{var[t,r,o]=[e.functions,e.templates,e.tools],n=!1,a=(e,r)=>{var a="LI"===r.target.tagName.toUpperCase()?r.target:$.parent(r.target,"li");if(!a||a===e||a.classList.contains("menu-check")||!a.querySelector(":scope > ul")){var l=!e.classList.contains("active");l&&o.menu_rarrow(e),Array.prototype.forEach.call(n,t=>{var r=l&&t===e&&!t.classList.contains("disabled");t.classList.toggle("active",r);var o=t.querySelector(":scope > ul");o&&(o.style.display=r?"block":"none",r&&(o=s(o,!1,"Top")))});var i=!1,c=r.target;if(c instanceof Element)for(var d=0;d++<3;){if("tagName"in c&&"string"==typeof c.tagName&&"LI"===c.tagName.toUpperCase()){!c.classList.contains("menu-check")&&c.classList.contains("menu")||(i=!0);break}c=c.parentElement}if(i&&!c.classList.contains("disabled")){var u=!1;if(c.classList.contains("menu-check")?(u="check",c.classList.toggle("active")):u="click",r.subtype=u,"function"!=typeof a.onclick){var p=a.getAttribute("onclick-function");try{if(p=JSON.parse(p),"function"!=typeof t[p[0]])throw""}catch(r){p=!1}"function"==typeof t[p[0]]?t[p[0]].apply(a,[r,...p.slice(1)]):"function"==typeof a.onmousedown?a.onmousedown.apply(a,[r,a,e]):"function"==typeof e.onmenudown&&e.onmenudown.apply(e,[r,a,e])}else a.onclick.apply(a,[r,a,e])}}},s=(t,r)=>{var o=(t.getAttribute("context-reference")||"default").capitalize()+"Context";if("function"==typeof window[o]){var n=window[o](t,e.tools.selected.window(),e.tools.selected.lines(),r);"object"==typeof n&&(t=n)}return t};window.menu_overflow=(e=>{var t=e.parentNode,r=t.getBoundingClientRect(),o=document.body.getBoundingClientRect();r.top+r.height>o.height&&(t.style.height=Math.floor(o.height-r.top)+"px")}),window.menu_display=((e,t,r,o)=>{e=e.cloneNode(!0);var n=document.createElement("div");return n.style.top=r+"px",n.style.left=t+"px",o=Object.assign({class:""},o),Array.prototype.forEach.call(o.class.split(" "),e=>{n.classList.add(e)}),n.appendChild(e),window.menu_show=n,document.body.appendChild(n),window.menu_overflow(e),e});n=document.querySelectorAll(".menu"),window.dresize.menu_init=(e=>{Array.prototype.forEach.call(document.querySelectorAll(".toolbar-menu > li > ul"),e=>{})}),window.dresize.menu_init(),window.dmousedown.menu_init=(e=>{$.parent(e.target,".menu")||Array.prototype.forEach.call(document.body.querySelectorAll(".menu"),e=>{e.classList.remove("active"),Array.prototype.forEach.call(e.querySelectorAll(":scope > ul"),e=>{e.style.display=null})})}),Array.prototype.forEach.call(n,e=>{e.querySelector(":scope > ul")&&(e.onmousemove=(t=>{if(!e.classList.contains("active")&&e.parentElement.classList.contains("toolbar-menu")){var r=!1;Array.prototype.forEach.call(n,e=>{e.classList.contains("active")&&(r=!0)}),r&&e.onmousedown(t)}}),e.onmousedown=(t=>{a(e,t)}))}),(()=>{var e=!1,t=!1;window.menu_show=!1,window.dmousedown.menu_context_close=(e=>{if(!$.parent(e.target,".menu-stay")){t&&clearTimeout(t);var r=!1;t=setTimeout(()=>{Array.prototype.forEach.call(document.body.querySelectorAll(":scope > .context-right, :scope > .context-columns"),e=>{$.parent(e,".context-right, .context-columns")||e===window.menu_show||(r=!0,e.remove())}),window.menu_show=!1,r&&Array.prototype.forEach.call(document.querySelectorAll(".menu.active, .menu-icon.active"),e=>{if(e.hasAttribute("context-right")){var t=e.querySelector(":scope > ul");t&&t.style.display&&"none"!==t.style.display||e.classList.remove("active")}})},10)}}),window.dmousedown.menu_context_right=(t=>{var n=t.target.hasAttribute("context-right")||t.target.parentNode.hasAttribute("context-right"),l=n?t.target.hasAttribute("context-right")?t.target:t.target.parentNode:$.parent(t.target,"[context-right]");if(l){var i=l.classList.contains("menu-icon");if(i&&l.classList.contains("active"))return l.classList.remove("active");if((2===t.button||i)&&"TH"!==t.target.tagName.toUpperCase()){var c="TR"===t.target.tagName.toUpperCase()?t.target:$.parent(t.target,"tr",l);if((n||c)&&document.body.querySelector(":scope > .context-menu")!==e){t.preventDefault();var d=document.createElement("div");d.classList.add("context-right"),d.classList.add("menu");var u=t.clientX,p=t.clientY;if(i){var y=l.getBoundingClientRect();u=y.x,p=y.y+y.height}d.style.top=p+"px",d.style.left=u+"px",setTimeout(()=>{var t=r.get(l.getAttribute("context-right")+(n?"-other":""),!1,!0);if(t){t=s(t.cloneNode(!0),n),i&&l.classList.add("active"),window.menu_show=e=d,d.appendChild(t),document.body.appendChild(d);var c=t.getBoundingClientRect(),u=p+c.height-window.innerHeight;u>0&&(d.style.top=p-u-5+"px"),o.menu_rarrow(d),window.menu_overflow(t),t.onmousedown=(e=>{a(d,e)}),window.menu_show=!1}},50)}}}})})(),Array.prototype.forEach.call(document.querySelectorAll("[context-menu]"),e=>{var t=e.getAttribute("context-menu");if(t){var r=document.getElementById(t);r&&(r=r.cloneNode(!0),e.appendChild(r))}});var l=e=>{var t={};Array.prototype.forEach.call(document.querySelectorAll("#grid .cell"),e=>{var r=e.querySelector(":scope > .title .text").innerText,o=e.querySelector(":scope > .title .subtext").innerText;t[e.uid]={name:r+o,icon:"flag",class:e.classList.contains("active")?"active":"",attrs:{"data-uid":e.uid,"onclick-function":'["cell_active","'+e.uid+'"]'}}});var r=Handlebars.compile("{{> menu-each this}}")({children:t});e.innerHTML=r};window.dmousedown.main_toolbar=(t=>{if($.parent(t.target,".main-toolbar")){var r="LI"===t.target.tagName.toUpperCase()?t.target:$.parent(t.target,"li"),o=r&&r.getAttribute("name"),n=o&&r.querySelector(":scope > ul");switch(o){case"pinned-layouts":l(n);break;case"lock-panels":e.functions.win_lock()}}}),window.TopViewContext=(e=>{var t=document.body.classList.contains("locked");e.querySelector('[name="lock-panels"]').style.display=t?"none":"block",e.querySelector('[name="unlock-panels"]').style.display=t?"block":"none";var r=document.body.classList.contains("main-toolbar");e.querySelector('[name="main-toolbar"]').classList.toggle("active",r),l(e.querySelector('[name="pinned-layouts"] > ul'))})}),window.microtime=(e=>{let t,r;return"undefined"!=typeof performance&&performance.now?(r=(performance.now()+performance.timing.navigationStart)/1e3,e?r:(t=0|r,`${Math.round(1e6*(r-t))/1e6} ${t}`)):(r=(Date.now?Date.now():(new Date).getTime())/1e3,e?r:(t=0|r,`${Math.round(1e3*(r-t))/1e3} ${t}`))}),window.fmicrotime=(()=>{var e=window.microtime().split(" ");return parseInt(e[1])+parseFloat(e[0])}),window.hmicrotime=(()=>window.fmicrotime().toString(16)),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t,r,[o,n]=[e.tools,e.templates];window.dkeyup.table_search=(e=>{if(e.target.matches(".search input")){var t=e.target.value.trim(),r=$.parent(e.target,".cell");Array.prototype.forEach.call(r.querySelectorAll("table > tbody > tr:not([row-template])"),e=>{var r=!t||e.innerText.indexOf(t)>=0;e.classList.toggle("search-hide",!r)})}}),window.table_resize=(()=>{Array.prototype.forEach.call(document.querySelectorAll("table th"),e=>{if(!e.querySelectorAll(".table-resize").length){var o=document.createElement("div");o.classList.add("table-resize"),o.innerHTML="&nbsp;",o.style.position="absolute",o.style.top=0,o.style.right=0,o.style.bottom=0,o.style.width="5px",o.style.background="initial",o.style.cursor="col-resize",o.addEventListener("mousedown",o=>{t=e,r=e.offsetWidth-o.pageX}),e.appendChild(o)}})}),window.dmutation.table_resize=window.table_resize,window.dmousemove.table_resize=(e=>{t&&(t.style.width=r+e.pageX+"px")}),window.dmouseup.table_resize=(()=>{t=!1});window.table_sort=(t=>{var r=t instanceof Event?t.target:t;if(!(t instanceof Event?t.button:0)&&r.matches(".win table > thead > tr > th:not([col-name=icon]), .win table > thead > tr > th:not([col-name=icon]) *:not(.table-resize)")){var o="TH"==r.tagName.toUpperCase()?r:$.parent(r,"th"),n=$.parent(o,"table"),a=o.getAttribute("col-sort");a=(a=["up","down"].indexOf(a||"")>=0&&a)?"down"==a&&"up":"down",Array.prototype.forEach.call(n.querySelectorAll("th[col-name]"),e=>{e.removeAttribute("col-sort")}),a&&o.setAttribute("col-sort",a),e.functions.table_sort(n)}}),window.dmousedown.table_sort=window.table_sort,window.dmousedown.table_columns=(e=>{var t=$.parent(e.target,"table");if(2===e.button&&"TH"===e.target.tagName.toUpperCase()&&t&&t.hasAttribute("context-columns")){var r={},o=(t.getAttribute("col-hides")||"").split("|");Array.prototype.forEach.call(t.querySelectorAll("th[col-name]"),(e,t)=>{var n=e.getAttribute("col-name");e.textContent.replace(/(&nbsp;)/g,"").trim()&&(r[n]={elem:e,text:e.textContent,active:o.indexOf(n)<0})});var a=window.menu_display(n.get("cell-menu-columns",r,!0),e.clientX,e.clientY,{class:"menu menu-stay context-columns"});a.onclick=(e=>{var r="LI"==e.target.tagName.toUpperCase()?e.target:$.parent(e.target,"li",a);if(r&&"LI"==r.tagName.toUpperCase()){r.classList.toggle("active");var n=r.classList.contains("active"),s=r.getAttribute("col-name"),l=o.indexOf(s);n&&l>=0?delete o[l]:!n&&l<0&&o.push(s),o=Array.prototype.filter.call(o,String),t.setAttribute("col-hides",o.join("|")),(s=t.getAttribute("col-storage"))&&(localStorage[s+"_cols"]=t.getAttribute("col-hides"))}})}}),table_resize(),(()=>{var e="selected",t=down=start=selected=parent=!1,r=(e,t)=>{var r="object"==typeof t&&t instanceof Element&&"tagName"in t&&"string"==typeof t.tagName&&"TR"==t.tagName.toUpperCase();return r&&(r=s(e,t)>=0),r},n=(e,t,r)=>e.querySelectorAll(":scope > tbody > tr"+(t?".selected":"")+(r?"":":not(.search-hide):not(.filter-hide)")),a=(e,t)=>{var o=t;"object"==typeof t&&t instanceof MouseEvent&&"function"==typeof t.composedPath&&(o=t.composedPath());var n=!1;return"object"==typeof o&&Array.isArray(o)?(Array.prototype.forEach.call(o,t=>{!n&&r(e,t)&&(n=t)}),n):n},s=(e,t,r)=>{var o=-1;return"object"==typeof r&&Array.isArray(r)||(r=n(e)),Array.prototype.forEach.call(r,(e,r)=>{e===t&&(o=r)}),o},l=e=>Array.prototype.slice.call(e.parentNode.children).indexOf(e),i=(e,t,r)=>{for(var o=[],n=e.nextElementSibling;n&&n!==t;)(r||n.matches(":scope:not(.search-hide):not(.filter-hide)"))&&o.push(n),n=n.nextElementSibling;return o},c=!1,d=!1;window.dmousedown.table_selection=(r=>{if((t="TABLE"===r.target.tagName.toUpperCase()?r.target:$.parent(r.target,"table"))&&t.parentElement&&t.parentElement.classList.contains("frame")){var s,u=a(t,r),p=n(t,!0);if(2==r.button&&(!u||u&&u.classList.contains("selected")))return down=!1;if(down=!1,start=!1,selected=!1,parent=t.parentElement,win=$.parent(t,".win"),d=u.classList.contains(e),selected=!(2===r.button||!u||1!==p.length)&&d,u&&r.shiftKey)c&&l(c)!=l(u)&&((e,t)=>Array.prototype.slice.call(e.children).indexOf(t)>=0)(u.parentNode,c)?((s=l(c)>l(u)?i(u,c):i(c,u)).push(u),s.push(c),Array.prototype.forEach.call(s,t=>{t.classList.toggle(e,!0)})):u.classList.toggle(e),c=!!(u=c).classList.contains(e)&&u,window.getSelection().removeAllRanges();else r.ctrlKey||Array.prototype.forEach.call(n(t,!0,!0),t=>t.classList.remove(e));if(!u)return t.onmousedown&&t.onmousedown(r,!0);selected||u.classList.add(e),start=u,0===r.button&&(down=!0),win&&o.infos_print(win)}});var u=(l,i)=>{var c=a(t,l),d=n(t),u=[start];c!==start&&(selected=!1,u=((e,t)=>{var o=-1,a=-1;if(!r(e,t)||(o=s(e,t))<0||(a=s(e,start))<0)return[];if(a<o){var l=a;a=o,o=l}return Array.prototype.slice.call(n(e)).slice(o,++a)})(t,c)),(l.shiftKey||l.ctrlKey)&&(i||c===start)||selected||(Array.prototype.forEach.call(u,t=>t.classList.add(e)),Array.prototype.forEach.call(d,r=>{s(t,r,u)<0&&r.classList.remove(e)}),Array.prototype.forEach.call(u,t=>t.classList.add(e))),i&&(down=!1),win&&o.infos_print(win)};window.dmousemove.table_selection=(e=>{down&&(e.target===t||$.parent(e.target,t,parent))&&u(e)}),window.dmouseup.table_selection=(r=>{if(down&&(r.target===t||$.parent(r.target,t,parent))){u(r,!0);var o=a(t,r);!r.shiftKey&&o===start&&d?start.classList.remove(e):c=o}})})()}),document.addEventListener("DOMContentLoadedAfanasy",e=>{window.ArrowContext=((t,r,o,n)=>{r.parentNode;var a=r.getAttribute("cell-type"),s=t.querySelector('[name="selected-filter"]'),l=t.querySelector('[name="clear-filter"]'),i=e.functions.get_filters(a),c=decodeURIComponent(r.getAttribute("selected-filter")||"");c in i||(c="",r.removeAttribute("selected-filter"));var d=0,u={"no-filter":{name:"cell-menu-arrow-other.selected-filter.no-filter",icon:"cross",class:c?"":"active"}};Object.keys(i).length&&(u.s1="separator",Array.prototype.forEach.call(Object.keys(i),e=>{u["selected-filter_"+ ++d]={name:e,icon:"flag",class:e===c?"active":"",attrs:{"filter-name":encodeURIComponent(e)}}}));var p=Handlebars.compile("{{> menu-each this}}")({children:u});s.querySelector("ul").innerHTML=p,Array.prototype.forEach.call(s.querySelectorAll("ul > li[name]"),e=>{e.onclick=(t=>{var o=e.getAttribute("filter-name");o&&"no-filter"!=o?r.setAttribute("selected-filter",o):r.removeAttribute("selected-filter")})}),c?l.onclick=(t=>{delete i[c],e.functions.set_filters(a,i)}):l.classList.add("disabled")})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n,a]=[e.tools,e.config,e.global,e.system];window.JobsNode=((s,l,i)=>new Promise((c,d)=>{if(!s||!s.length)return d(!1);var u=function(){this.parentNode.classList.toggle("children-roll")},p=(e,t)=>{},y=function(e,t){r.columns(...arguments),Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id]:not([node-id*=":"])'),e=>{var r=e.getAttribute("node-id"),o=e.classList.contains("children-roll");Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id^="'+r+':"]'),e=>{var t=!e.classList.contains("hide");(!t&&o||t&&!o)&&e.classList.toggle("hide",!o)})})},m=(t,s,l,i)=>{var c,d=l.blocks,u=d.length,p=void 0!==i;if(!u)return{};var y=d[0],g=!l.host_name,f=l.id,_=l.name,b=(l.state||o.cell_empty).trim().split(" ").slice(-1)[0],h={infos:{total:0},length:0,total:0,done:0,skipped:0,warning:0,ready:0,waitdep:0,running:0,error_ready:0,error:0,waitreconnect:0,null:0},v="",w=y.service,A=y.p_tasks_done||0,S=y.tasks_num||0,k=y.p_percentage||0,x=y.capacity||0,q="",C=p||u<=1;!p&&l.user_list_order&&s.setAttribute("node-order",l.user_list_order);var E="afanasy"==l.name&&"afadmin"==l.user_name;p||u>=2?(E&&s.setAttribute("node-order",p?y.block_num:-1),p?(_="<strong>"+y.name+"</strong>",b=(y.state||"").trim(),s.parentNode||(f=l.id+":"+y.block_num,_=l.name+"["+y.name+"]",s.removeAttribute("node-child"),s.setAttribute("node-id",f)),r.infos_pile(l,i,h.infos)):(w=!1,_+=" <strong>("+(g?e.langs.get("cell-jobs.batch"):u+" "+e.langs.get("cell-jobs.jobs"))+")</strong>",k=y.p_percentage,A=0,S=0,x=0,Array.prototype.forEach.call(d,(e,o)=>{var n=t.querySelector('[node-id="'+l.id+":"+e.block_num+'"]');n||(n=s.cloneNode(!0));var a=Object.assign({},l);if(a.blocks=[e],r.merge(h,m(t,n,a,o)),!n.parentNode){var i=t.querySelectorAll('[node-id^="'+l.id+':"]');(i=!!i.length&&Array.prototype.slice.call(i,-1)[0])&&i.parentNode||(i=s),i.after(n)}A+=e.p_tasks_done||0,S+=e.tasks_num||0,x+=e.capacity||0}))):(_+=" &gt; <strong>"+y.name+"</strong>",r.infos_pile(l,i,h.infos)),E||s.ondblclick||(s.ondblclick=(()=>{window.TasksWin(l,i)})),u<=1?s.removeAttribute("node-child"):s.getAttribute("node-child")!=u&&s.setAttribute("node-child",u),c={frames_range:"Frame Range:\nFirst: %1\nLast: %2",frames_inc:"\nIncrement: %1",frames_per_task:"\nPer Task: %1",sequential:"\nSequential: %1"};var L="";a.check_block_flag(y.flags,"numeric")&&(L=c.frames_range.replaceArr([y.frame_first,y.frame_last]),y.frames_inc>1&&(L+=c.frames_inc.replaceArr([y.frames_inc])),y.frames_per_task>1&&(L+=c.frames_per_task.replaceArr([y.frames_per_task])),null!=y.sequential&&1!=y.sequential&&(L+=c.sequential.replaceArr([y.sequential]))),L&&(v=(v?v+"\n":"")+L);var O="";y.depend_mask&&(O.length&&(O+="\n"),O+='Depend mask = "'+y.depend_mask+'".'),y.tasks_depend_mask&&(O.length&&(O+="\n"),O+='Tasks depend mask = "'+y.tasks_depend_mask+'".'),y.depend_sub_task&&(O.length&&(O+="\n"),O+="Subtasks depend."),O&&(v=(v?v+"\n":"")+O),s.setAttribute("title",L);var N=s.querySelector(".col-icon img");w&&("none"==N.style.display||N.src.indexOf(w)<0)?(N.src=o.logos_prefix+w+".png",N.style.display="inline-block"):w||"none"==N.style.display||(N.src=o.logos_default,N.style.display="none"),(j=s.querySelector(".col-name")).innerHTML!=_&&(j.innerHTML=_),s.querySelector(".col-user").textContent=l.user_name;var j=s.querySelector(".col-running"),T=p?y:l,M="time_"+(!p&&g?"creation":"started"),D=!1,I=o.cell_empty;T[M]&&(I=r.time.diff.get(T[M],T.time_done||!0,!1,"."),T.time_done||(D=T[M])),D?j.setAttribute("current-time",D):j.removeAttribute("current-time"),j.textContent=I,s.querySelector(".col-creation").textContent=(T.time_creation||0).toDate(o.cell_empty),s.querySelector(".col-started").textContent=(T.time_started||0).toDate(o.cell_empty),s.querySelector(".col-done").textContent=(T.time_done||0).toDate(o.cell_empty),s.querySelector(".col-branch").textContent=l.branch||o.cell_empty,s.querySelector(".col-capacity").textContent=x||o.cell_empty,s.querySelector(".col-priority").textContent=T.priority||o.cell_empty;var z=" - ";C&&y.p_tasks_run_time&&y.p_tasks_done&&(z="sum: "+r.time.diff.unit(T[M],T.time_done||!0)+" | average: "+r.time.unit(y.p_tasks_run_time/y.p_tasks_done));if(s.querySelector(".col-render").textContent=z,c=a.ui_level.padawan()?{tasks_num:"Tasks[<b>%1</b>]",frames_num:"Frames[<b>%1</b>]( <b>%2</b> - <b>%3</b>%4 )",frames_inc:" / Increment<b>%1</b>",frames_per_task:" : PerTask<b>%1</b>",sequential:" % Sequential<b>%1</b>"}:a.ui_level.jedi()?{tasks_num:"Tasks[<b>%1</b>]",frames_num:"Frames[<b>%1</b>]( <b>%2</b> - <b>%3</b>%4 )",frames_inc:" / Inc<b>%1</b>",frames_per_task:" : FPT<b>%1</b>",sequential:" % Seq<b>%1</b>"}:{tasks_num:"t<b>%1</b>",frames_num:"f<b>%1</b>(<b>%2</b>-<b>%3</b>%4)",frames_inc:"/<b>%1</b>",frames_per_task:":<b>%1</b>",sequential:"%<b>%1</b>"},a.check_block_flag(y.flags,"numeric")){var H="";y.frames_inc>1&&(H+=c.frames_inc.replaceArr(y.frames_inc)),y.frames_per_task>1&&(H+=c.frames_per_task.replaceArr(y.frames_per_task)),null!=y.sequential&&1!=y.sequential&&(H+=c.sequential.replaceArr(y.sequential)),q=(q?q+" | ":"")+c.frames_num.replaceArr([y.tasks_num,y.frame_first,y.frame_last,H])}else q=(q?q+" | ":"")+c.tasks_num.replaceArr([y.tasks_num]);c=a.ui_level.padawan()?{depend_mask:" Depends(<b>%1</b>)",tasks_depend_mask:" TasksDepends[<b>%1</b>]",depend_sub_task:" [<b>Sub-Task Dependence</b>]"}:a.ui_level.jedi()?{depend_mask:" Dep(<b>"+y.depend_mask+"</b>)",tasks_depend_mask:" TDep[<b>"+y.tasks_depend_mask+"</b>]",depend_sub_task:" [<b>Sub-Task</b>]"}:{depend_mask:" d(<b>"+y.depend_mask+"</b>)",tasks_depend_mask:" t[<b>"+y.tasks_depend_mask+"</b>]",depend_sub_task:" [<b>sub</b>]"};var R="";y.depend_mask&&(R+=c.depend_mask.replaceArr([y.depend_mask])),y.tasks_depend_mask&&(R+=c.tasks_depend_mask.replaceArr([y.tasks_depend_mask])),y.depend_sub_task&&(R+=c.depend_sub_task.replaceArr([])),R&&(q=(q?q+" | ":"")+R),c=a.ui_level.padawan()?{task_max_run_time:"TaskMaxRunTime: <b>%1</b>",task_min_run_time:"TaskMinRunTime: <b>%1</b>",errors_forgive_time:"ErrorsForgiveTime: <b>%1</b>",errors_solving:"ErrorsSolving: ( Avoid: <b>%1</b>, Task: <b>%2</b>, Retries: <b>%3</b> )",need_memory:"Memory&gt;<b>%1</b>",need_hdd:"HDDSpace&gt;<b>%1</b>",need_power:"Power&gt;<b>%1</b>",need_properties:"Properties(<b>%1</b>)",runtime:"Render Timings: Sum:<b>%1</b> / Average:<b>%2</b>"}:a.ui_level.jedi()?{task_max_run_time:"MaxRun: <b>%1</b>",task_min_run_time:"MinRun: <b>%1</b>",errors_forgive_time:"ErrForgive: <b>%1</b>",errors_solving:"ErrSlv: ( Block: <b>%1</b>, Task: <b>%2</b>, Retries: <b>%3</b> )",need_memory:"Mem&gt;<b>%1</b>",need_hdd:"HDD&gt;<b>%1</b>",need_power:"Pow&gt;<b>%1</b>",need_properties:"Props(<b>%1</b>)",runtime:"Timings: Sum:<b>%1</b> / Avg:<b>%2</b>"}:{task_max_run_time:"Mrt: <b>%1</b>",task_min_run_time:"mrt: <b>%1</b>",errors_forgive_time:"f: <b>%1</b>",errors_solving:"e: ( <b>%1b, <b>%2t</b>, <b>%3r</b> )",need_memory:"m&gt;<b>%1</b>",need_hdd:"h&gt;<b>%1</b>",need_power:"p&gt;<b>%1</b>",need_properties:"<b>%1</b>",runtime:"rt:s<b>%1</b>/a<b>%2</b>"};var $=-1,U=-1,P=-1;y.errors_avoid_host&&($=y.errors_avoid_host),y.errors_task_same_host&&(U=y.errors_task_same_host),y.errors_retries&&(P=y.errors_retries),null!=y.task_max_run_time&&(q=(q?q+" | ":"")+c.task_max_run_time.replaceArr([r.time.unit(y.task_max_run_time)])),null!=y.task_min_run_time&&(q=(q?q+" | ":"")+c.task_min_run_time.replaceArr([r.time.unit(y.task_min_run_time)])),null!=y.errors_forgive_time&&y.errors_forgive_time>=0&&(q=(q?q+" | ":"")+c.errors_forgive_time.replaceArr([r.time.unit(y.errors_forgive_time)])),-1==$&&-1==U&&-1==P||(q=(q?q+" | ":"")+c.errors_solving.replaceArr([$,U,P])),y.need_memory&&(q=(q?q+" | ":"")+c.need_memory.replaceArr([y.need_memory])),y.need_hdd&&(q=(q?q+" | ":"")+c.need_hdd.replaceArr([y.need_hdd])),y.need_power&&(q=(q?q+" | ":"")+c.need_power.replaceArr([y.need_power])),y.need_properties&&(q=(q?q+" | ":"")+c.need_properties.replaceArr([y.need_properties])),(j=s.querySelector(".col-details")).innerHTML!=q&&(j.innerHTML=q);var W=e.config.states;((H=s.getAttribute("node-status"))!=b||H||b)&&s.setAttribute("node-status",b),s.querySelector(".col-status").textContent=void 0!==W[b]?e.langs.get(W[b]):o.cell_empty,k=Math.floor(A/S*100);j=s.querySelector(".col-progress");Array.prototype.forEach.call(j.querySelectorAll(".col-progress-text"),e=>{e.textContent=k+" % ("+A+"/"+S+")"}),C&&Array.prototype.forEach.call(d,(e,t)=>{if("string"==typeof e.p_progressbar){for(var r=e.p_progressbar,o=0;o<r.length;++o)switch(r[o]){case"D":++h.done;break;case"S":++h.skipped;break;case"G":++h.warning;break;case"r":++h.ready;break;case"W":++h.waitdep;break;case"R":++h.running;break;case"N":++h.warning;break;case"Y":++h.error_ready;break;case"E":++h.error;break;case"C":++h.waitreconnect;break;default:++h.null}h[t]=r,h.total+=r.length,++h.length}});var J=0;return h.total&&(J=Math.floor((h.error+h.error_ready)/h.total*100)),s.querySelector(".col-errors").textContent=J.toString()+" %",j.querySelector(".progress").setAttribute("style",r.progress2bar(h)),p||(n.nodes_data.jobs[f]={name:l.name,data:l}),h},g=(e,t,r)=>{var o=[];t?(Array.prototype.forEach.call(t.blocks,e=>{o.push(e.block_num.toString())}),Array.prototype.forEach.call(e.querySelectorAll(':scope > [node-id^="'+t.id+':"]'),e=>{var t=e.getAttribute("node-id");t=t.substr(t.indexOf(":")+1).toString(),o.indexOf(t)<0&&e.remove()})):Array.prototype.forEach.call(e.querySelectorAll(':scope > [node-id="'+r+'"], :scope > [node-id^="'+r+':"]'),e=>{e.remove()})},f=Date.now(),_=l||!t;if(_=(_=_||i&&f-1e3>t)||!i&&f-2e4>t){t=f;a.xhr.send({get:{type:"jobs"}},(e,t,o)=>{if(null===e)return d(o.target.status);var a={},l=[];Array.prototype.forEach.call(Object.keys(e.jobs),t=>{var r=e.jobs[t];a[r.id.toString()]=r,l.push(r.id.toString())});var i={};r.table(s,(e,t)=>{var o=!1,s=[];Array.prototype.forEach.call(t[0].tbody.querySelectorAll(":scope > tr[node-id]:not([row-template])"),e=>{var o=e.getAttribute("node-id").toString(),c=o.indexOf(":");if(c>=0&&(o=o.substr(0,c).toString(),e=t[0].tbody.querySelector(':scope > tr[node-id="'+o+'"]')),g(t[0].tbody,a[o],o),s.indexOf(o)<0){if(s.push(o),l.indexOf(o)<0){var d=n.nodes_data.jobs;return o.indexOf(":")<0&&Array.prototype.forEach.call(Object.keys(d),e=>{e.indexOf(o+":")||delete d[e]}),delete d[o],e.remove()}r.merge(i,m(t[0].tbody,e,a[o]))}});var c=t[0].tbody.querySelector(":scope > tr:not([node-order])");Array.prototype.forEach.call(Object.keys(a),e=>{if(g(t[0].tbody,a[e],e),!(s.indexOf(e)>=0)){var n=t[0].template.cloneNode(!0);n.setAttribute("node-id",a[e].id),c?c.before(n):(o=!0,t[0].tbody.prepend(n)),r.merge(i,m(t[0].tbody,n,a[e])),n.querySelector(".col-icon").onmousedown=u,c=a[e].user_list_order?c:n}}),o&&window.table_sort(t[0].elem),r.infos_print(e,i.infos),e.querySelector(".frame-circ .pie").setAttribute("style",r.progress2bar(i)),y(e,t)}),c({refresh:!0})})}else r.table(s,p,(e,t)=>{Array.prototype.forEach.call(t[0].tbody.querySelectorAll("[current-time]"),e=>{var t=e.getAttribute("current-time");e.textContent=r.time.diff.get(t,!0,!1,".")})},y),c({refresh:!1})})),window.JobsContext=((e,t,r,o)=>{o&&!r.length&&e.querySelector('[name="job-menu"]').classList.add("disabled")}),window.JobsSort=((e,t)=>{var r=e.getAttribute("node-order")||0;return(t.getAttribute("node-order")||0)-r}),window.TasksWin=((t,r)=>{var o=e.functions.win_add(!1,"tasks",!1,!1,!1,{subtitle:t.name});n.nodes_data.tasks[o.uid]={id:t.id,name:t.name,child:r},window.cell_refresh("tasks")})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n]=[e.tools,e.config,e.global];window.LogsNode=((n,a,s)=>new Promise((l,i)=>{if(!n||!n.length)return i(!1);var c=(e,t)=>{},d=function(e,t){r.columns(...arguments)},u=Date.now(),p=a||!t;(p=(p=p||s&&u-500>t)||!s&&u-2e3>t)?(t=u,(e=>{r.table(n,(t,n)=>{var a={};Array.prototype.forEach.call(Object.keys(e),t=>{var s=[];Array.prototype.forEach.call(e[t]||[],e=>{s.unshift(e)});var l=!1;Array.prototype.forEach.call(n,e=>{l||e.elem.getAttribute("node-head")!=t||(l=e)}),Array.prototype.forEach.call(s,e=>{if(!(e.id<s[0].id)){var n=e.id||"0",i=l&&l.tbody.querySelector('[node-id^="'+n+'-"]');if(l&&!i&&(i=l.template.cloneNode(!0)).setAttribute("node-id",n+"-"+(e.cycle||"0")),r.merge(a,((e,t,r,n)=>{var a={infos:{total:0}};return t&&(t.querySelector(".col-id").textContent=r.id||o.cell_empty,t.querySelector(".col-cycle").textContent=r.cycle,t.querySelector(".col-count").textContent=r.count,t.querySelector(".col-register").textContent=(r.register||0).toDate(o.cell_empty),t.querySelector(".col-activity").textContent=(r.activity||0).toDate(o.cell_empty),t.parentNode||(t.querySelector(".col-msg").innerHTML=r.msg)),++a.infos.total,a.infos[n]=1,a})(l&&l.tbody,i,e,t)),l&&i&&!i.parentNode){var c=l&&l.tbody.querySelector("[node-id]:last-child");i.classList.add("tr-"+(c&&c.classList.contains("tr-odd")?"even":"odd")),l.tbody.appendChild(i)}}}),(e=>{e&&Array.prototype.forEach.call(Array.prototype.slice.call(e.querySelectorAll(":scope > tr[node-id]:not([row-template])")).reverse().slice(o.logs_max),e=>{e.remove()})})(l.tbody)}),r.infos_print(t,a.infos,!0),d(t,n)}),l({refresh:!0})})(e.global.logs)):(r.table(n,c,d),l({refresh:!1}))})),window.dmousedown["cell-logs"]=(t=>{var r=$.parent(t.target,".cell");if(r){var o=r.querySelector(".win .frame-tabs > [tab-id].active > table, .win .frame-first > table");(t.target.classList.contains("clean")||t.target.parentNode.classList.contains("clean"))&&(e.global.logs[o.getAttribute("node-head")]=[],Array.prototype.forEach.call(o.querySelectorAll(":scope > tbody > tr:not([row-template])"),e=>{e.remove()}))}})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n,a]=[e.tools,e.config,e.global,e.system];window.MonitorsNode=((e,s,l)=>new Promise((i,c)=>{if(!e||!e.length)return c(!1);var d=(e,t)=>{},u=function(e,t){r.columns(...arguments)},p=(e,t,a,s)=>{var l={infos:{total:0}};a.solve_method;a.solve_need,t.querySelector(".col-id").textContent=a.id,t.querySelector(".col-name").textContent=a.name,t.querySelector(".col-uid").textContent=a.uid,t.querySelector(".col-user").textContent=a.user_name||o.cell_empty;var i=a.address;6==i.family&&(i.ip="["+i.ip+"]"),t.querySelector(".col-ip").textContent=i.ip+(i.port?":"+i.port:""),t.querySelector(".col-events").textContent=a.events&&Array.isArray(a.events)?a.events.join(", "):o.cell_empty,t.querySelector(".col-register").textContent=(a.time_register||0).toDate(o.cell_empty),t.querySelector(".col-launch").textContent=(a.time_launch||0).toDate(o.cell_empty),t.querySelector(".col-update").textContent=(a.time_update||0).toDate(o.cell_empty),t.querySelector(".col-activity").textContent=(a.time_activity||0).toDate(o.cell_empty),t.querySelector(".col-host").textContent=a.host_name||o.cell_empty,t.querySelector(".col-priority").textContent=a.priority||o.cell_empty;var c="",d=r.isset(a.task_max_run_time,a.errors_forgive_time,a.errors_avoid_host,a.errors_task_same_host,a.errors_retries);return s&&(primary||d)&&(c+="ErrorsForgiveTime: "+r.time.unit(a.errors_forgive_time),c+=" | ErrorsSolving( Avoid: "+a.errors_avoid_host+" Task: "+a.errors_task_same_host+" Retries: "+a.errors_retries+" )"),t.querySelector(".col-details").textContent=c,++l.infos.total,n.nodes_data.monitors[a.id]={name:a.name,data:a},l},y=Date.now(),m=s||!t;if(m=(m=m||l&&y-1e3>t)||!l&&y-2e4>t){t=y;a.xhr.send({get:{type:"monitors"}},(t,o,a)=>{if(null===t)return c(a.target.status);var s={},l=[];Array.prototype.forEach.call(t.monitors,e=>{s[e.id.toString()]=e,l.push(e.id.toString())});var d={};r.table(e,(e,t)=>{var o=[];Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id]:not([node-id*=":"]):not([row-template])'),e=>{var a=e.getAttribute("node-id").toString();if(l.indexOf(a)<0)return delete n.nodes_data.monitors[a],e.remove();o.push(a),r.merge(d,p(t[0].tbody,e,s[a])),t[0].tbody,s[a]}),Array.prototype.forEach.call(Object.keys(s),e=>{if(!(o.indexOf(e)>=0)){var n=t[0].template.cloneNode(!0);n.setAttribute("node-id",e),t[0].tbody.appendChild(n),r.merge(d,p(t[0].tbody,n,s[e])),t[0].tbody,s[e]}}),r.infos_print(e,d.infos),u(e,t)}),i({refresh:!0})})}else r.table(e,d,u),i({refresh:!1})})),window.MonitorsContext=((e,t,r,o)=>{o&&!r.length&&e.querySelector('[name="monitor-menu"]').classList.add("disabled")})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n,a]=[e.tools,e.config,e.global,e.system];window.RendersNode=((s,l,i)=>new Promise((c,d)=>{if(!s||!s.length)return d(!1);var u=(e,t)=>{},p=function(e,t){r.columns(...arguments)},y=(t,a,s,l)=>{var i=s.netifs;if(!i.length)return{};var c=i[0],d=(s.state||o.cell_empty).trim().split(" ").slice(-1)[0],u={infos:{total:0},length:0,total:0,online:0,running:0,offline:0,null:0},p="ONL"===d,y="RUN"===d,m="OFF"===d,g=(c.p_percentage,0);"number"==typeof s.task_start_finish_time&&"number"==typeof s.host.max_tasks&&(g=s.task_start_finish_time+" / "+s.host.max_tasks);var f=0;"number"==typeof s.capacity_used&&"number"==typeof s.host.capacity&&(f=s.capacity_used+" / "+s.host.capacity),a.querySelector(".col-id").textContent=s.id,a.querySelector(".col-name").textContent=s.name,a.querySelector(".col-user").textContent=s.user_name,a.querySelector(".col-status").textContent=d,a.querySelector(".col-os").textContent=s.host.os||o.cell_empty,a.querySelector(".col-tasks").textContent=g,a.querySelector(".col-register").textContent=(s.time_register||0).toDate(o.cell_empty),a.querySelector(".col-launch").textContent=(s.time_launch||0).toDate(o.cell_empty),a.querySelector(".col-update").textContent=(s.time_update||0).toDate(o.cell_empty),a.querySelector(".col-idle").textContent=(s.idle_time||0).toDate(o.cell_empty),a.querySelector(".col-busy").textContent=(s.busy_time||0).toDate(o.cell_empty),a.querySelector(".col-wol-op").textContent=(s.wol_operation_time||0).toDate(o.cell_empty),a.querySelector(".col-idle-cpu").textContent="number"==typeof s.host.nimby_idle_cpu?s.host.nimby_idle_cpu:o.cell_empty,a.querySelector(".col-busy-cpu").textContent="number"==typeof s.host.nimby_busy_cpu?s.host.nimby_busy_cpu:o.cell_empty,a.querySelector(".col-idle-mem").textContent="number"==typeof s.host.nimby_idle_mem?s.host.nimby_idle_mem:o.cell_empty,a.querySelector(".col-busy-mem").textContent="number"==typeof s.host.nimby_busy_mem?s.host.nimby_busy_mem:o.cell_empty,a.querySelector(".col-idle-swp").textContent="number"==typeof s.host.nimby_idle_swp?s.host.nimby_idle_swp:o.cell_empty,a.querySelector(".col-busy-swp").textContent="number"==typeof s.host.nimby_busy_swp?s.host.nimby_busy_swp:o.cell_empty,a.querySelector(".col-idle-hddgb").textContent="number"==typeof s.host.nimby_idle_hddgb?s.host.nimby_idle_hddgb:o.cell_empty,a.querySelector(".col-busy-hddgb").textContent="number"==typeof s.host.nimby_busy_hddgb?s.host.nimby_busy_hddgb:o.cell_empty,a.querySelector(".col-idle-hddio").textContent="number"==typeof s.host.nimby_idle_hddio?s.host.nimby_idle_hddio:o.cell_empty,a.querySelector(".col-busy-hddio").textContent="number"==typeof s.host.nimby_busy_hddio?s.host.nimby_busy_hddio:o.cell_empty,a.querySelector(".col-capacity").textContent=f||o.cell_empty,a.querySelector(".col-priority").textContent=s.priority||o.cell_empty;a.querySelector(".col-details").textContent="";var _=e.config.states,b=a.getAttribute("node-status");(b!=d||b||d)&&a.setAttribute("node-status",d),a.querySelector(".col-status").textContent=void 0!==_[d]?e.langs.get(_[d]):o.cell_empty;var h=!1,v=!1,w=s.address.family;return Array.prototype.forEach.call(c.addresses,e=>{if(e.family==w){if(!v&&t){var t=":0000:0000:0000:0000:0000:0000:0000"!==e.ip.slice(-35);(t=(t=t&&".0"!==e.ip.slice(-2))&&".255"!==e.ip.slice(-4))&&(v=e)}h||e.ip!=s.address.ip||(h=e)}}),h||(h=v||s.address),6==h.family&&(h.ip="["+h.ip+"]"),a.querySelector(".col-interface").textContent=c.name,a.querySelector(".col-mac").textContent=c.mac||o.cell_empty,a.querySelector(".col-ip").textContent=h.ip+(h.port?":"+h.port:""),++u.total,u.online+=p?1:0,u.running+=y?1:0,u.offline+=m?1:0,u.null+=p||y||m?0:1,r.infos_pile(s,l,u.infos),n.nodes_data.renders[s.id]={name:s.name,data:s},u},m=Date.now(),g=l||!t;if(g=(g=g||i&&m-1e3>t)||!i&&m-5e3>t){t=m;a.xhr.send({get:{type:"renders"}},(e,t,o)=>{if(null===e)return d(o.target.status);var a={},l=[];Array.prototype.forEach.call(e.renders,e=>{a[e.id.toString()]=e,l.push(e.id.toString())});var i={};r.table(s,(e,t)=>{var o=!1,s=[];Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id]:not([node-id*=":"]):not([row-template])'),e=>{var o=e.getAttribute("node-id").toString();if(l.indexOf(o)<0)return delete n.nodes_data.renders[o],e.remove();s.push(o),r.merge(i,y(t[0].tbody,e,a[o])),t[0].tbody,a[o]}),Array.prototype.forEach.call(Object.keys(a),e=>{if(!(s.indexOf(e)>=0)){var n=t[0].template.cloneNode(!0);n.setAttribute("node-id",e),t[0].tbody.appendChild(n),o=!0,r.merge(i,y(t[0].tbody,n,a[e])),t[0].tbody,a[e]}}),o&&window.table_sort(t[0].elem),r.infos_print(e,i.infos),e.querySelector(".frame-circ .pie").setAttribute("style",r.progress2bar(i,(e,t)=>{var r=!1;switch(e){case 1:r=t.online;break;case 2:r=t.running;break;case 3:r=t.offline;break;case 4:r=t.null}return r})),p(e,t)}),c({refresh:!0})})}else r.table(s,u,p),c({refresh:!1})})),window.RendersContext=((e,t,r,o)=>{o&&!r.length&&e.querySelector('[name="render-menu"]').classList.add("disabled")})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n,a]=[e.tools,e.config,e.global,e.system];window.TasksNode=((s,l,i)=>new Promise((c,d)=>{if(!s||!s.length)return d(!1);var u=function(){this.parentNode.classList.toggle("children-roll")},p=(e,t)=>{},y=function(e,t){r.columns(...arguments),Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id]:not([node-id*=":"])'),e=>{var r=e.getAttribute("node-id"),o=e.classList.contains("children-roll");Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id^="'+r+':"]'),e=>{var t=!e.classList.contains("hide");(!t&&o||t&&!o)&&e.classList.toggle("hide",!o)})})},m=(t,a,s,l,i,c)=>{var d=!1,p={};Array.prototype.forEach.call(l.job_progress.progress,(t,i)=>{var c={tasks:t,job:s.job,node:s.node,block:s.node.data.blocks[i]};c.block.id=i;var y=a[0].tbody.querySelector(':scope > tr[node-id="'+(i||"0")+'"]:not([row-template])'),m=!!y;m||((y=a[0].template.cloneNode(!0)).setAttribute("node-id",i),a[0].tbody.appendChild(y),d=!0),a[0].tbody,r.merge(p,((t,a,s,l)=>{var i={infos:{total:0},length:0,total:0,done:0,running:0,error:0,null:0},c=s.node,d=s.block;if(d){var u=a.getAttribute("node-id"),p=0,y=0,m=0,g=0,f=r.merge({},c.data);f.blocks=!1,delete f.blocks,Array.isArray(n.nodes_data.tasks[u])||(n.nodes_data.tasks[u]=[]),Array.prototype.forEach.call(s.tasks,(_,b)=>{var h=t.querySelector('[node-id="'+u+":"+b+'"]');h||(h=a.cloneNode(!0)).setAttribute("node-id",u+":"+b);var v=_.str||0,w=_.err||0,A=(_.state||o.cell_empty).trim().split(" ").slice(-1)[0];_.id=b,d.task_num=_.id,_.gen_name=function(e,t,r){var o=t.task_num,n="task "+o,a=t.tasks_name;if(t.tasks){var s=t.tasks[o].name;return s?n=a?a.replace("@#@",s):s:a&&(n=a.replace("@#@",""+o)),n}return function(e,t,r){var o=t.task_num*t.frames_per_task*t.frames_inc;t.frames_inc>1&&(o-=o%t.frames_inc),t.frame_start=t.frame_first+o,o=t.frames_per_task*t.frames_inc-1,t.frame_start+o>t.frame_last&&(o=t.frame_last-t.frame_start),t.frames_inc>1&&(o-=o%t.frames_inc),t.frame_end=t.frame_start+o,t.frames_inc>1?t.frames_num=(t.frame_end-t.frame_start)/t.frames_inc+1:t.frames_num=t.frame_end-t.frame_start+1}(0,t),a?(n=a).replace("@#@",""+t.frame_start):n="frame "+t.frame_start+(t.frames_num>1?"-"+t.frame_end:""),n}(c.data,d,s.tasks),h.querySelector(".col-name").textContent=_.gen_name,h.querySelector(".col-starts").textContent=v,h.querySelector(".col-errors").textContent=w;var S=e.config.states,k=h.getAttribute("node-status");(k!=A||k||A)&&h.setAttribute("node-status",A),h.querySelector(".col-status").textContent=void 0!==S[A]?e.langs.get(S[A]):o.cell_empty;var x=h.querySelector(".col-running"),q=!_.tdn&&_.tst,C=r.time.diff.get(_.tst,_.tdn||!0,!1,".");if(q?x.setAttribute("current-time",q):x.removeAttribute("current-time"),x.textContent=C,h.querySelector(".col-started").textContent=(_.tst||0).toDate(o.cell_empty),h.querySelector(".col-done").textContent=(_.tdn||0).toDate(o.cell_empty),h.querySelector(".col-host").textContent=_.hst||o.cell_empty,h.ondblclick||(h.ondblclick=(()=>{window.TaskDetailsWin(s.job,l,c,d,_)})),!h.parentNode){var E=t.querySelectorAll('[node-id^="'+u+':"]');(E=!!E.length&&Array.prototype.slice.call(E,-1)[0])&&E.parentNode||(E=a),E.after(h)}switch(A){case"RUN":++i.running;break;case"DON":++i.done;break;case"ERR":++i.error;break;default:++i.null}p+=v,y+=w,m=!m||_.tst&&_.tst<m?_.tst:m,g=!g||_.tdn&&_.tdn>g?_.tdn:g,r.infos_pile(_,l,i.infos);var L={job:f,block:d,task:_};n.nodes_data.tasks[u][b]={name:_.gen_name,data:L}});var _="<strong>"+d.name+" ("+(d.tasks?"array":"numeric")+")</strong>",b=(d.state||o.cell_empty).trim().split(" ").slice(-1)[0];a.setAttribute("node-child",s.tasks.length),(w=a.querySelector(".col-name")).innerHTML!=_&&(w.innerHTML=_),a.querySelector(".col-starts").textContent=p,a.querySelector(".col-errors").textContent=y;var h=e.config.states,v=a.getAttribute("node-status");(v!=b||v||b)&&a.setAttribute("node-status",b),a.querySelector(".col-status").textContent=void 0!==h[b]?e.langs.get(h[b]):o.cell_empty;var w=a.querySelector(".col-running"),A=!g&&m,S=r.time.diff.get(m,g||!0,!1,".");A?w.setAttribute("current-time",A):w.removeAttribute("current-time"),w.textContent=S,a.querySelector(".col-started").textContent=(m||0).toDate(o.cell_empty),a.querySelector(".col-done").textContent=(g||0).toDate(o.cell_empty),a.querySelector(".col-host").textContent=o.cell_empty,i.total+=d.tasks_num;var k={job:f,block:d,tasks:s.tasks};return n.nodes_data.tasks[u][-1]={name:d.name,data:k},i}})(a[0].tbody,y,c,i));var g=y.querySelector(".col-icon");g.onmousedown=u,m||1!=l.job_progress.progress.length||g.onmousedown.apply(g)}),d&&window.table_sort(a[0].elem);r.infos_print(t,p.infos),t.querySelector(".frame-circ .pie").setAttribute("style",r.progress2bar(p,(e,t)=>{var r=!1;switch(e){case 1:r=t.done;break;case 2:r=t.running;break;case 3:r=t.error;break;case 4:r=t.null}return r})),y(t,a)},g=Date.now(),f=l||!t;(f=(f=f||i&&g-1e3>t)||!i&&g-2e4>t)?(t=g,(()=>{var e=!1,t=[];r.table(s,(r,o)=>{var s=r.parentNode;if(s.uid&&s.uid in n.nodes_data.tasks){t.push(s.uid);var l=n.nodes_data.tasks[s.uid],i={job:l,node:n.nodes_data.jobs[l.id]},c={type:"jobs",ids:[l.id],mode:"progress"};a.xhr.send({get:c},function(t,n,a){if(null===t)return e=a.target.status;m(r,o,i,...arguments)})}}),Array.prototype.forEach.call(n.nodes_data.tasks,(e,r)=>{r in t||(e.remove?delete n.nodes_data.tasks[r]:e.remove=!0)}),c({refresh:!e})})()):(r.table(s,p,(e,t)=>{Array.prototype.forEach.call(t[0].tbody.querySelectorAll("[current-time]"),e=>{var t=e.getAttribute("current-time");e.textContent=r.time.diff.get(t,!0,!1,".")})},y),c({refresh:!1}))})),window.TasksContext=((e,t,r,o)=>{o&&!r.length&&e.querySelector('[name="task-menu"]').classList.add("disabled")}),window.TaskDetailsWin=((t,o,n,s,l)=>{var i,c=0,d=!1,u=()=>{var o={type:"jobs",ids:[t.id],mode:"info",block_ids:[s.id],task_ids:[l.id],mon_id:g_id};a.xhr.send({get:o},o=>{("object"==typeof o.task&&o.task.job_name&&(i=o,c=o.task.pos.number),e.tools.ping_refresh(d),d)||((d=e.functions.win_add(!1,"task-details",!1,!1,!1,{subtitle:n,style:"min-width: 650px; min-height: 250px;"})).querySelector(".subtitle .task-skip").onmousedown=(t=>{e.functions.win_actions.fn.base(t,null,"action_task","skip",[i.task.pos.task],[i.task.pos.block],i.task.pos.job),e.tools.ping_refresh(d)}),d.querySelector(".subtitle .task-restart").onmousedown=(t=>{e.functions.win_actions.fn.base(t,null,"action_task","restart",[i.task.pos.task],[i.task.pos.block],i.task.pos.job),e.tools.ping_refresh(d)}),(f=d.querySelector('.subtitle > .rinfos select[name="output_num"]')).selectedIndex=c,f.onchange=(e=>{var t=parseInt(f.value),r=d.querySelector('[tab-target="output"]');b("output",{number:t},(e,r)=>{r&&(c=t,f.selectedIndex=c)}),r.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))}));var n="Task[%1][%2][%3]".replaceArr([i.task.job_name,i.task.block_name,i.task.task_name]);d.querySelector(".title .subtext").textContent=n;var p=d.querySelector(".subtitle > .infos"),y=r.time.diff.get(i.task.progress.tst,i.task.progress.tdn||!0,!1,"."),m=i.task.progress.str||0,g=i.task.progress.hst||e.langs.get("cell-task-details.infos.host.default");p.textContent=e.langs.get("cell-task-details.infos").replaceArr([i.task.progress.state,m,g,y]);var f=d.querySelector('select[name="output_num"]');if(Array.prototype.forEach.call([...Array(parseInt(m)+1).keys()],e=>{if(!(f.options.length>e)){var t=document.createElement("option");t.text=e,t.value=e,f.appendChild(t)}}),"object"==typeof i.task.exec){var _=d.querySelector('[tab-id="exec"]');_.querySelector('input[name="name"]').value=i.task.exec.name,_.querySelector('input[name="capacity"]').value=i.task.exec.capacity,_.querySelector('input[name="service"]').value=i.task.exec.service,_.querySelector('input[name="parser"]').value=i.task.exec.parser,_.querySelector('input[name="directory"]').value=i.task.exec.working_directory,_.querySelector('.istextarea[name="raw"]').textContent=JSON.stringify(i.task.exec,void 0,2)}var b=(r,o,n)=>{var c=d.querySelector('[tab-id="'+r+'"]');if(c){var u={type:"jobs",ids:[t.id],mode:r,block_ids:[s.id],task_ids:[l.id],mon_id:g_id};o&&(u=e.tools.merge(u,o)),a.xhr.send({get:u},t=>{e.tools.ping_refresh(d);var o="object"==typeof t.task&&t.task.job_name;o&&(i=t),"function"==typeof n&&n(t,o);var a=t.task&&t.task.data||t.info&&t.info.text;c.textContent=a||e.langs.get("cell-task-details.empty."+r)})}};d.querySelector('[tab-target="exec"]').onclick=(()=>{u()}),d.querySelector('[tab-target="output"]').onclick=(()=>{b("output",{number:c})}),d.querySelector('[tab-target="log"]').onclick=(()=>{b("log")}),d.querySelector('[tab-target="error_hosts"]').onclick=(()=>{b("error_hosts")}),d.querySelector('[tab-target="listen"]').onclick=(()=>{b("listen")})})};u()})}),document.addEventListener("DOMContentLoadedAfanasy",e=>{var t=0,[r,o,n,a]=[e.tools,e.config,e.global,e.system];window.UsersNode=((e,s,l)=>new Promise((i,c)=>{if(!e||!e.length)return c(!1);var d=(e,t)=>{},u=function(e,t){r.columns(...arguments)},p=(e,t,a,s)=>{var l={infos:{total:0}},i="solve_priority"==a.solve_method?"Priority":"Order";i+=", "+("solve_capacity"==a.solve_need?"Capacity":"RunTasks"),t.querySelector(".col-id").textContent=a.id,t.querySelector(".col-user").textContent=a.name,t.querySelector(".col-jobs").textContent=a.jobs_num||0,t.querySelector(".col-register").textContent=(a.time_register||0).toDate(o.cell_empty),t.querySelector(".col-activity").textContent=(a.time_activity||0).toDate(o.cell_empty),t.querySelector(".col-host").textContent=a.host_name||o.cell_empty,t.querySelector(".col-solving").textContent=i,t.querySelector(".col-priority").textContent=a.priority||o.cell_empty;var c="",d=r.isset(a.task_max_run_time,a.errors_forgive_time,a.errors_avoid_host,a.errors_task_same_host,a.errors_retries);return s&&(primary||d)&&(c+="ErrorsForgiveTime: "+r.time.unit(a.errors_forgive_time),c+=" | ErrorsSolving( Avoid: "+a.errors_avoid_host+" Task: "+a.errors_task_same_host+" Retries: "+a.errors_retries+" )"),t.querySelector(".col-details").textContent=c,++l.infos.total,n.nodes_data.users[a.id]={name:a.name,data:a},l},y=Date.now(),m=s||!t;if(m=(m=m||l&&y-1e3>t)||!l&&y-2e4>t){t=y;a.xhr.send({get:{type:"users"}},(t,o,a)=>{if(null===t)return c(a.target.status);var s={},l=[];Array.prototype.forEach.call(t.users,e=>{s[e.id.toString()]=e,l.push(e.id.toString())});var d={};r.table(e,(e,t)=>{var o=!1,a=[];Array.prototype.forEach.call(t[0].tbody.querySelectorAll(':scope > tr[node-id]:not([node-id*=":"]):not([row-template])'),e=>{var o=e.getAttribute("node-id").toString();if(l.indexOf(o)<0)return delete n.nodes_data.users[o],e.remove();a.push(o),r.merge(d,p(t[0].tbody,e,s[o])),t[0].tbody,s[o]}),Array.prototype.forEach.call(Object.keys(s),e=>{if(!(a.indexOf(e)>=0)){var n=t[0].template.cloneNode(!0);n.setAttribute("node-id",e),t[0].tbody.appendChild(n),o=!0,r.merge(d,p(t[0].tbody,n,s[e])),t[0].tbody,s[e]}}),o&&window.table_sort(t[0].elem),r.infos_print(e,d.infos),u(e,t)}),i({refresh:!0})})}else r.table(e,d,u),i({refresh:!1})})),window.UsersContext=((e,t,r,o)=>{o&&!r.length&&e.querySelector('[name="user-menu"]').classList.add("disabled")})});